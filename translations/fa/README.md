<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "94449afc70ef625a5360a67829a017b3",
  "translation_date": "2025-09-30T09:16:28+00:00",
  "source_file": "README.md",
  "language_code": "fa"
}
-->
# نمونه MCP Server و PostgreSQL - تحلیل فروش خرده‌فروشی

## یادگیری MCP با ادغام پایگاه داده از طریق مثال‌های عملی

[![مشارکت‌کنندگان GitHub](https://img.shields.io/github/contributors/microsoft/MCP-Server-and-PostgreSQL-Sample-Retail.svg)](https://GitHub.com/microsoft/MCP-Server-and-PostgreSQL-Sample-Retail/graphs/contributors)
[![مشکلات GitHub](https://img.shields.io/github/issues/microsoft/MCP-Server-and-PostgreSQL-Sample-Retail.svg)](https://GitHub.com/microsoft/MCP-Server-and-PostgreSQL-Sample-Retail/issues)
[![درخواست‌های کششی GitHub](https://img.shields.io/github/issues-pr/microsoft/MCP-Server-and-PostgreSQL-Sample-Retail.svg)](https://GitHub.com/microsoft/MCP-Server-and-PostgreSQL-Sample-Retail/pulls)
[![درخواست‌های کششی خوش‌آمدید](https://img.shields.io/badge/PRs-welcome-brightgreen.svg?style=flat-square)](http://makeapullrequest.com)

[![پیوستن به دیسکورد Azure AI Foundry](https://dcbadge.limes.pink/api/server/ByRwuEEgH4)](https://discord.com/invite/ByRwuEEgH4)

برای شروع استفاده از این منابع، مراحل زیر را دنبال کنید:

1. **فورک کردن مخزن**: [اینجا کلیک کنید برای فورک کردن](https://github.com/microsoft/MCP-Server-and-PostgreSQL-Sample-Retail/fork)
2. **کلون کردن مخزن**: `git clone https://github.com/YOUR-USERNAME/MCP-Server-and-PostgreSQL-Sample-Retail.git`
3. **پیوستن به دیسکورد Azure AI Foundry**: [با کارشناسان و توسعه‌دهندگان دیگر ملاقات کنید](https://discord.com/invite/ByRwuEEgH4)

### 🌐 پشتیبانی چندزبانه

#### پشتیبانی شده از طریق GitHub Action (خودکار و همیشه به‌روز)

[فرانسوی](../fr/README.md) | [اسپانیایی](../es/README.md) | [آلمانی](../de/README.md) | [روسی](../ru/README.md) | [عربی](../ar/README.md) | [فارسی](./README.md) | [اردو](../ur/README.md) | [چینی (ساده‌شده)](../zh/README.md) | [چینی (سنتی، ماکائو)](../mo/README.md) | [چینی (سنتی، هنگ‌کنگ)](../hk/README.md) | [چینی (سنتی، تایوان)](../tw/README.md) | [ژاپنی](../ja/README.md) | [کره‌ای](../ko/README.md) | [هندی](../hi/README.md) | [بنگالی](../bn/README.md) | [مراتی](../mr/README.md) | [نپالی](../ne/README.md) | [پنجابی (گرمکی)](../pa/README.md) | [پرتغالی (پرتغال)](../pt/README.md) | [پرتغالی (برزیل)](../br/README.md) | [ایتالیایی](../it/README.md) | [لهستانی](../pl/README.md) | [ترکی](../tr/README.md) | [یونانی](../el/README.md) | [تایلندی](../th/README.md) | [سوئدی](../sv/README.md) | [دانمارکی](../da/README.md) | [نروژی](../no/README.md) | [فنلاندی](../fi/README.md) | [هلندی](../nl/README.md) | [عبری](../he/README.md) | [ویتنامی](../vi/README.md) | [اندونزیایی](../id/README.md) | [مالایی](../ms/README.md) | [تاگالوگ (فیلیپینی)](../tl/README.md) | [سواحیلی](../sw/README.md) | [مجاری](../hu/README.md) | [چکی](../cs/README.md) | [اسلواکی](../sk/README.md) | [رومانیایی](../ro/README.md) | [بلغاری](../bg/README.md) | [صربی (سیریلیک)](../sr/README.md) | [کرواتی](../hr/README.md) | [اسلوونیایی](../sl/README.md) | [اوکراینی](../uk/README.md) | [برمه‌ای (میانمار)](../my/README.md)

**اگر می‌خواهید زبان‌های ترجمه اضافی پشتیبانی شوند، لیست زبان‌های پشتیبانی شده [اینجا](https://github.com/Azure/co-op-translator/blob/main/getting_started/supported-languages.md) موجود است**

## مقدمه

این نمونه نشان می‌دهد که چگونه می‌توان یک **سرور Model Context Protocol (MCP)** جامع ایجاد و مستقر کرد که دستیارهای هوش مصنوعی را قادر می‌سازد به داده‌های فروش خرده‌فروشی از طریق PostgreSQL به صورت امن و هوشمند دسترسی پیدا کنند. این پروژه ویژگی‌های سطح سازمانی مانند **امنیت سطح ردیف (RLS)**، **قابلیت‌های جستجوی معنایی** و **ادغام Azure AI** را برای سناریوهای واقعی تحلیل خرده‌فروشی به نمایش می‌گذارد.

**موارد استفاده کلیدی:**
- **تحلیل فروش مبتنی بر هوش مصنوعی**: امکان پرسش و تحلیل داده‌های فروش خرده‌فروشی از طریق زبان طبیعی برای دستیارهای هوش مصنوعی
- **دسترسی امن چند مستأجری**: نمایش پیاده‌سازی امنیت سطح ردیف که در آن مدیران فروشگاه‌های مختلف فقط به داده‌های فروشگاه خود دسترسی دارند
- **جستجوی معنایی محصولات**: نمایش کشف محصولات با استفاده از تعبیه‌های متنی هوش مصنوعی
- **ادغام سازمانی**: نشان دادن نحوه ادغام سرورهای MCP با خدمات Azure و پایگاه داده‌های PostgreSQL

**مناسب برای:**
- توسعه‌دهندگانی که می‌خواهند سرورهای MCP با ادغام پایگاه داده بسازند
- مهندسان داده که راه‌حل‌های تحلیل امن چند مستأجری پیاده‌سازی می‌کنند
- توسعه‌دهندگان برنامه‌های هوش مصنوعی که با داده‌های خرده‌فروشی یا تجارت الکترونیک کار می‌کنند
- هر کسی که علاقه‌مند به ترکیب دستیارهای هوش مصنوعی با پایگاه داده‌های سازمانی است

## به جامعه دیسکورد Azure AI Foundry بپیوندید
تجربیات خود را در مورد MCP به اشتراک بگذارید و با کارشناسان و گروه‌های محصول ملاقات کنید

[![دیسکورد Azure AI](https://dcbadge.limes.pink/api/server/ByRwuEEgH4)](https://discord.com/invite/ByRwuEEgH4)

# سرور MCP تحلیل فروش

یک سرور Model Context Protocol (MCP) که دسترسی جامع به پایگاه داده فروش مشتریان برای کسب‌وکار DIY خرده‌فروشی Zava را فراهم می‌کند. این سرور به دستیارهای هوش مصنوعی امکان می‌دهد داده‌های فروش خرده‌فروشی را از طریق یک رابط امن و آگاه به طرح پرسش و تحلیل کنند.

## 📚 راهنمای کامل پیاده‌سازی

برای تجزیه و تحلیل دقیق نحوه ساخت این راه‌حل و نحوه پیاده‌سازی سرورهای مشابه MCP، به راهنمای جامع **[نمونه راهنما](Sample_Walkthrough.md)** مراجعه کنید. این راهنما شامل موارد زیر است:

- **بررسی عمیق معماری**: تحلیل اجزا و الگوهای طراحی
- **ساخت مرحله به مرحله**: از تنظیم پروژه تا استقرار
- **تجزیه و تحلیل کد**: توضیح دقیق پیاده‌سازی سرور MCP
- **ویژگی‌های پیشرفته**: امنیت سطح ردیف، جستجوی معنایی و نظارت
- **بهترین شیوه‌ها**: دستورالعمل‌های امنیت، عملکرد و توسعه
- **رفع اشکال**: مشکلات رایج و راه‌حل‌ها

مناسب برای توسعه‌دهندگانی که می‌خواهند جزئیات پیاده‌سازی را درک کنند و راه‌حل‌های مشابه بسازند.

## 🤖 MCP (Model Context Protocol) چیست؟

**Model Context Protocol (MCP)** یک استاندارد باز است که به دستیارهای هوش مصنوعی امکان می‌دهد به منابع داده خارجی و ابزارها به صورت امن و در زمان واقعی دسترسی پیدا کنند. این پروتکل مانند پلی عمل می‌کند که مدل‌های هوش مصنوعی را به پایگاه داده‌ها، APIها، سیستم‌های فایل و سایر منابع متصل می‌کند و امنیت و کنترل را حفظ می‌کند.

### مزایای کلیدی:
- **دسترسی به داده‌های زمان واقعی**: دستیارهای هوش مصنوعی می‌توانند پایگاه داده‌ها و APIهای زنده را پرسش کنند
- **ادغام امن**: دسترسی کنترل‌شده با احراز هویت و مجوزها  
- **قابلیت گسترش ابزارها**: افزودن قابلیت‌های سفارشی به دستیارهای هوش مصنوعی
- **پروتکل استاندارد شده**: کارکرد در پلتفرم‌ها و ابزارهای مختلف هوش مصنوعی

### تازه‌وارد به MCP؟

اگر با Model Context Protocol آشنا نیستید، توصیه می‌کنیم با منابع جامع مبتدی مایکروسافت شروع کنید:

**📖 [راهنمای MCP برای مبتدیان](https://aka.ms/mcp-for-beginners)**

این منبع شامل موارد زیر است:
- معرفی مفاهیم و معماری MCP
- آموزش‌های مرحله به مرحله برای ساخت اولین سرور MCP
- بهترین شیوه‌ها برای توسعه MCP
- مثال‌های ادغام با پلتفرم‌های محبوب هوش مصنوعی
- منابع و پشتیبانی جامعه

پس از درک اصول اولیه، به اینجا بازگردید تا این پیاده‌سازی پیشرفته تحلیل خرده‌فروشی را بررسی کنید!

## 📚 راهنمای جامع یادگیری: /walkthrough

این مخزن شامل یک **راهنمای آموزشی ۱۲ ماژوله** کامل است که نمونه سرور MCP خرده‌فروشی را به درس‌های قابل فهم و مرحله به مرحله تقسیم می‌کند. این راهنما این مثال عملی را به یک منبع آموزشی جامع تبدیل می‌کند که برای توسعه‌دهندگانی که می‌خواهند سرورهای MCP آماده تولید با ادغام پایگاه داده بسازند، مناسب است.

### آنچه یاد خواهید گرفت

این راهنما همه چیز را از مفاهیم پایه MCP تا استقرار پیشرفته تولید پوشش می‌دهد، از جمله:

- **مبانی MCP**: درک پروتکل Model Context و کاربردهای واقعی آن
- **ادغام پایگاه داده**: پیاده‌سازی اتصال امن PostgreSQL با امنیت سطح ردیف
- **ویژگی‌های پیشرفته هوش مصنوعی**: افزودن قابلیت‌های جستجوی معنایی با تعبیه‌های Azure OpenAI
- **پیاده‌سازی امنیت**: احراز هویت، مجوزدهی و جداسازی داده‌ها در سطح سازمانی
- **توسعه ابزارها**: ساخت ابزارهای پیچیده MCP برای تحلیل داده و هوش تجاری
- **آزمایش و رفع اشکال**: استراتژی‌های جامع آزمایش و تکنیک‌های رفع اشکال
- **ادغام با VS Code**: پیکربندی AI Chat برای پرسش‌های پایگاه داده با زبان طبیعی
- **استقرار تولید**: کانتینری‌سازی، مقیاس‌پذیری و استراتژی‌های استقرار ابری
- **نظارت و مشاهده‌پذیری**: Application Insights، ثبت ساختاری و نظارت بر عملکرد

### نمای کلی مسیر یادگیری

این راهنما یک ساختار یادگیری پیشرفته را دنبال می‌کند که برای توسعه‌دهندگان با هر سطح مهارت طراحی شده است:

| ماژول | حوزه تمرکز | توضیحات | زمان تخمینی |
|--------|------------|-------------|---------------|
| **[00-Introduction](walkthrough/00-Introduction/README.md)** | پایه | مفاهیم MCP، مطالعه موردی Zava Retail، نمای کلی معماری | ۳۰ دقیقه |
| **[01-Architecture](walkthrough/01-Architecture/README.md)** | الگوهای طراحی | معماری فنی، طراحی لایه‌ای، اجزای سیستم | ۴۵ دقیقه |
| **[02-Security](walkthrough/02-Security/README.md)** | امنیت سازمانی | احراز هویت Azure، امنیت سطح ردیف، جداسازی چند مستأجری | ۶۰ دقیقه |
| **[03-Setup](walkthrough/03-Setup/README.md)** | محیط | تنظیم Docker، Azure CLI، پیکربندی پروژه، اعتبارسنجی | ۴۵ دقیقه |
| **[04-Database](walkthrough/04-Database/README.md)** | لایه داده | طرح PostgreSQL، pgvector، سیاست‌های RLS، داده نمونه | ۶۰ دقیقه |
| **[05-MCP-Server](walkthrough/05-MCP-Server/README.md)** | پیاده‌سازی اصلی | چارچوب FastMCP، ادغام پایگاه داده، مدیریت اتصال | ۹۰ دقیقه |
| **[06-Tools](walkthrough/06-Tools/README.md)** | توسعه ابزار | ایجاد ابزار MCP، اعتبارسنجی پرسش‌ها، ویژگی‌های هوش تجاری | ۷۵ دقیقه |
| **[07-Semantic-Search](walkthrough/07-Semantic-Search/README.md)** | ادغام هوش مصنوعی | تعبیه‌های Azure OpenAI، جستجوی برداری، استراتژی‌های جستجوی ترکیبی | ۶۰ دقیقه |
| **[08-Testing](walkthrough/08-Testing/README.md)** | تضمین کیفیت | آزمایش واحد، آزمایش ادغام، آزمایش عملکرد، رفع اشکال | ۷۵ دقیقه |
| **[09-VS-Code](walkthrough/09-VS-Code/README.md)** | تجربه توسعه | پیکربندی VS Code، ادغام AI Chat، جریان‌های کاری رفع اشکال | ۴۵ دقیقه |
| **[10-Deployment](walkthrough/10-Deployment/README.md)** | آماده تولید | کانتینری‌سازی، Azure Container Apps، خطوط CI/CD، مقیاس‌پذیری | ۹۰ دقیقه |
| **[11-Monitoring](walkthrough/11-Monitoring/README.md)** | مشاهده‌پذیری | Application Insights، ثبت ساختاری، معیارهای عملکرد | ۶۰ دقیقه |
| **[12-Best-Practices](walkthrough/12-Best-Practices/README.md)** | برتری تولید | تقویت امنیت، بهینه‌سازی عملکرد، الگوهای سازمانی | ۴۵ دقیقه |

**زمان کل یادگیری**: ~۱۲-۱۵ ساعت یادگیری جامع عملی

### 🎯 نحوه استفاده از راهنما

**برای مبتدیان**:
1. با [ماژول 00: مقدمه](walkthrough/00-Introduction/README.md) شروع کنید تا اصول MCP را درک کنید
2. ماژول‌ها را به ترتیب دنبال کنید تا تجربه یادگیری کاملی داشته باشید
3. هر ماژول بر اساس مفاهیم قبلی ساخته شده و شامل تمرین‌های عملی است

**برای توسعه‌دهندگان باتجربه**:
1. نمای کلی [راهنمای اصلی](walkthrough/README.md) را برای خلاصه ماژول‌ها مرور کنید
2. به ماژول‌های خاصی که به آن‌ها علاقه دارید (مثلاً ماژول 07 برای ادغام هوش مصنوعی) بروید
3. از ماژول‌های جداگانه به عنوان منابع مرجع برای پروژه‌های خود استفاده کنید

**برای پیاده‌سازی تولید**:
1. بر ماژول‌های 02 (امنیت)، 10 (استقرار) و 11 (نظارت) تمرکز کنید
2. ماژول 12 (بهترین شیوه‌ها) را برای دستورالعمل‌های سازمانی مرور کنید
3. از مثال‌های کد به عنوان قالب‌های آماده تولید استفاده کنید

### 🚀 گزینه‌های شروع سریع

**گزینه 1: مسیر یادگیری کامل** (توصیه شده برای تازه‌واردان)
```bash
# Clone and start with the introduction
git clone https://github.com/microsoft/MCP-Server-and-PostgreSQL-Sample-Retail.git
cd MCP-Server-and-PostgreSQL-Sample-Retail/walkthrough
# Follow along starting with 00-Introduction/README.md
```

**گزینه 2: پیاده‌سازی عملی** (مستقیماً وارد ساخت شوید)
```bash
# Start with setup and build as you learn
cd walkthrough/03-Setup
# Follow the setup guide and continue through implementation modules
```

**گزینه 3: تمرکز بر تولید** (استقرار سازمانی)
```bash
# Focus on production-ready aspects
# Review modules: 02-Security, 10-Deployment, 11-Monitoring, 12-Best-Practices
```

### 📋 پیش‌نیازهای یادگیری

**پیش‌زمینه پیشنهادی**:
- تجربه ابتدایی برنامه‌نویسی با پایتون
- آشنایی با REST APIها و پایگاه‌های داده
- درک کلی از مفاهیم هوش مصنوعی و یادگیری ماشین
- دانش پایه‌ای از خط فرمان و داکر

**ضروری نیست (اما مفید است)**:
- تجربه قبلی با MCP (ما از ابتدا این موضوع را پوشش می‌دهیم)
- تجربه کار با ابر Azure (راهنمای گام‌به‌گام ارائه می‌شود)
- دانش پیشرفته PostgreSQL (مفاهیم مورد نیاز توضیح داده می‌شوند)

### 💡 نکات یادگیری

1. **رویکرد عملی**: هر ماژول شامل نمونه‌های کد قابل اجرا و قابل تغییر است
2. **پیچیدگی تدریجی**: مفاهیم به‌صورت تدریجی از ساده به پیچیده ارائه می‌شوند
3. **زمینه واقعی**: تمام مثال‌ها از سناریوهای واقعی کسب‌وکار خرده‌فروشی استفاده می‌کنند
4. **آماده برای تولید**: نمونه‌های کد برای استفاده واقعی در تولید طراحی شده‌اند
5. **پشتیبانی جامعه**: به جامعه [Discord ما](https://discord.com/invite/ByRwuEEgH4) بپیوندید برای کمک و بحث‌ها

### 🔗 منابع مرتبط

- **[MCP برای مبتدیان](https://aka.ms/mcp-for-beginners)**: مطالعه ضروری پیش‌زمینه
- **[نمونه راهنما](Sample_Walkthrough.md)**: نمای کلی فنی سطح بالا
- **[Azure AI Foundry](https://azure.microsoft.com/en-us/products/ai-foundry)**: پلتفرم ابری مورد استفاده در مثال‌ها
- **[FastMCP Framework](https://github.com/jlowin/fastmcp)**: چارچوب پیاده‌سازی MCP با پایتون

**آماده برای شروع یادگیری هستید؟** با **[ماژول 00: مقدمه](walkthrough/00-Introduction/README.md)** شروع کنید یا **[نمای کلی کامل راهنما](walkthrough/README.md)** را بررسی کنید.

## پیش‌نیازها

1. نصب شده بودن Docker Desktop
2. نصب شده بودن Git
3. **Azure CLI**: نصب و احراز هویت با Azure CLI
4. دسترسی به مدل OpenAI `text-embedding-3-small` و به‌صورت اختیاری مدل `gpt-4o-mini`.

## شروع به کار

یک پنجره ترمینال باز کنید و دستورات زیر را اجرا کنید:

1. احراز هویت با Azure CLI

    ```bash
    az login
    ```

2. کلون کردن مخزن

    ```bash
    git clone https://github.com/gloveboxes/Zava-MCP-Server-and-PostgreSQL-Sample
    ```

3. رفتن به دایرکتوری پروژه

    ```bash
    cd Zava-MCP-Server-and-PostgreSQL-Sample
    ```

### استقرار منابع Azure

اسکریپت‌های زیر را اجرا کنید تا منابع Azure مورد نیاز برای سرور MCP به‌صورت خودکار مستقر شوند.

اسکریپت‌های استقرار به‌طور خودکار مدل `text-embedding-3-small` را مستقر می‌کنند. در طول استقرار، گزینه‌ای برای اضافه کردن مدل `gpt-4o-mini` نیز خواهید داشت. توجه داشته باشید که مدل `gpt-4o-mini` برای این پروژه **ضروری نیست** و فقط برای بهبودهای احتمالی آینده گنجانده شده است.

**اسکریپت مناسب برای پلتفرم خود را انتخاب کنید:**

#### ویندوز (PowerShell)

```powershell
# Run from the project root directory
cd infra && ./deploy.ps1
```

#### macOS/Linux (Bash)

```bash
# Run from the project root directory
cd infra && ./deploy.sh
```

## اجرای سرور MCP

ساده‌ترین راه برای اجرای کامل استک (PostgreSQL + سرور MCP) استفاده از Docker Compose است:

### شروع استک

```bash
# Start PostgreSQL and MCP Server
docker compose up -d

# View logs
docker compose logs -f

# View MCP Server Logs
docker compose logs -f mcp_server

# View the PostgreSQL Logs
docker compose logs -f pg17

# Stop the stack
docker compose down -v
```

## استفاده

فرض بر این است که از پشتیبانی داخلی سرور MCP در VS Code استفاده خواهید کرد.

1. پروژه را در VS Code باز کنید. از ترمینال اجرا کنید:

    ```bash
    code .
    ```

2. یک یا چند سرور MCP را با استفاده از تنظیمات موجود در `.vscode/mcp.json` شروع کنید. این فایل شامل چهار تنظیمات مختلف سرور است که هرکدام نمایانگر نقش متفاوت مدیر فروشگاه هستند:

   - هر تنظیمات از یک شناسه کاربری RLS (امنیت سطح ردیف) منحصر به فرد استفاده می‌کند
   - این شناسه‌های کاربری هویت‌های مختلف مدیران فروشگاه را که به پایگاه داده دسترسی دارند شبیه‌سازی می‌کنند
   - سیستم RLS دسترسی به داده‌ها را بر اساس فروشگاه اختصاص داده شده به مدیر محدود می‌کند
   - این سناریوهای واقعی را شبیه‌سازی می‌کند که مدیران فروشگاه با حساب‌های مختلف Entra ID وارد می‌شوند

    ```json
    {
        "servers": {
            "zava-sales-analysis-headoffice": {
                "url": "http://127.0.0.1:8000/mcp",
                "type": "http",
                "headers": {"x-rls-user-id": "00000000-0000-0000-0000-000000000000"}
            },
            "zava-sales-analysis-seattle": {
                "url": "http://127.0.0.1:8000/mcp",
                "type": "http",
                "headers": {"x-rls-user-id": "f47ac10b-58cc-4372-a567-0e02b2c3d479"}
            },
            "zava-sales-analysis-redmond": {
                "url": "http://127.0.0.1:8000/mcp",
                "type": "http",
                "headers": {"x-rls-user-id": "e7f8a9b0-c1d2-3e4f-5678-90abcdef1234"}
            },
            "zava-sales-analysis-online": {
                "url": "http://127.0.0.1:8000/mcp",
                "type": "http",
                "headers": {"x-rls-user-id": "2f4e6d8c-1a3b-5c7e-9f0a-b2d4f6e8c0a2"}
            }
        },
        "inputs": []
    }
    ```

### باز کردن چت هوش مصنوعی در VS Code

1. حالت چت هوش مصنوعی را در VS Code باز کنید
2. تایپ کنید **#zava** و یکی از سرورهای MCP که شروع کرده‌اید را انتخاب کنید
3. سوالاتی درباره داده‌های فروش بپرسید - نمونه سوالات زیر را ببینید

### نمونه سوالات

1. نمایش 20 محصول برتر بر اساس درآمد فروش
1. نمایش فروش بر اساس فروشگاه
1. فروش سه‌ماهه گذشته بر اساس دسته‌بندی چه بوده است؟
1. چه محصولاتی مشابه "ظروف برای رنگ" می‌فروشیم؟

## ویژگی‌ها

- **دسترسی به چند جدول**: بازیابی طرح‌های چندین جدول پایگاه داده در یک درخواست
- **اجرای امن پرس‌وجو**: اجرای پرس‌وجوهای PostgreSQL با پشتیبانی از امنیت سطح ردیف (RLS)
- **داده‌های بلادرنگ**: دسترسی به داده‌های فروش، موجودی و مشتری فعلی
- **ابزارهای تاریخ/زمان**: دریافت زمان‌های UTC فعلی برای تحلیل حساس به زمان
- **استقرار انعطاف‌پذیر**: پشتیبانی از حالت سرور HTTP

## جداول پشتیبانی‌شده

سرور به جداول پایگاه داده خرده‌فروشی زیر دسترسی فراهم می‌کند:

- `retail.customers` - اطلاعات و پروفایل‌های مشتری
- `retail.stores` - مکان‌ها و جزئیات فروشگاه‌ها
- `retail.categories` - دسته‌بندی محصولات و سلسله‌مراتب‌ها
- `retail.product_types` - طبقه‌بندی انواع محصولات
- `retail.products` - کاتالوگ محصولات و مشخصات
- `retail.orders` - سفارش‌های مشتری و تراکنش‌ها
- `retail.order_items` - اقلام فردی درون سفارش‌ها
- `retail.inventory` - سطوح موجودی فعلی و داده‌های انبار

## ابزارهای موجود

### `get_multiple_table_schemas`

بازیابی طرح‌های پایگاه داده برای چندین جدول در یک درخواست.

**پارامترها:**

- `table_names` (list[str]): لیستی از نام‌های جدول معتبر از جداول پشتیبانی‌شده بالا

**بازگشت‌ها:** رشته‌های طرح‌های ترکیبی برای جداول درخواست‌شده

### `execute_sales_query`

اجرای پرس‌وجوهای PostgreSQL در برابر پایگاه داده فروش با پشتیبانی از امنیت سطح ردیف.

**پارامترها:**

- `postgresql_query` (str): یک پرس‌وجوی PostgreSQL به‌خوبی شکل‌گرفته

**بازگشت‌ها:** نتایج پرس‌وجو به‌صورت رشته قالب‌بندی‌شده (محدود به 20 ردیف برای خوانایی)

**بهترین روش‌ها:**

- همیشه ابتدا طرح‌های جدول را بازیابی کنید
- از نام‌های دقیق ستون‌ها از طرح‌ها استفاده کنید
- جداول مرتبط را برای تحلیل جامع ترکیب کنید
- نتایج را در صورت لزوم تجمیع کنید
- خروجی را برای خوانایی محدود کنید

### `get_current_utc_date`

دریافت تاریخ و زمان فعلی UTC در قالب ISO.

**بازگشت‌ها:** تاریخ/زمان فعلی UTC در قالب ISO (YYYY-MM-DDTHH:MM:SS.fffffZ)

### `semantic_search_products`

انجام جستجوی معنایی برای محصولات بر اساس پرس‌وجوهای کاربر.

**بازگشت‌ها:** لیستی از محصولات مطابق با معیارهای جستجو

**پارامترها:**

- `query` (str): رشته پرس‌وجوی جستجو

**بازگشت‌ها:** لیستی از محصولات مطابق با معیارهای جستجو

## ویژگی‌های امنیتی

### امنیت سطح ردیف (RLS)

سرور امنیت سطح ردیف را برای اطمینان از اینکه کاربران فقط به داده‌هایی که مجاز به مشاهده آن هستند دسترسی دارند، اجرا می‌کند:

- **حالت HTTP**: از هدر `x-rls-user-id` برای شناسایی کاربر درخواست‌کننده استفاده می‌کند

- **پیش‌فرض جایگزین**: از UUID جایگزین استفاده می‌کند زمانی که هیچ شناسه کاربری ارائه نشده باشد

#### شناسه‌های کاربری RLS مخصوص فروشگاه

هر مکان فروشگاه Zava Retail دارای یک شناسه کاربری RLS منحصر به فرد است که تعیین می‌کند کدام داده‌ها کاربر می‌تواند به آن دسترسی داشته باشد:

| مکان فروشگاه | شناسه کاربری RLS | توضیحات |
|---------------|-------------|-------------|
| **دسترسی جهانی** | `00000000-0000-0000-0000-000000000000` | پیش‌فرض جایگزین - دسترسی به تمام فروشگاه‌ها |
| **سیاتل** | `f47ac10b-58cc-4372-a567-0e02b2c3d479` | داده‌های فروشگاه Zava Retail سیاتل |
| **بلویو** | `6ba7b810-9dad-11d1-80b4-00c04fd430c8` | داده‌های فروشگاه Zava Retail بلویو |
| **تاکوما** | `a1b2c3d4-e5f6-7890-abcd-ef1234567890` | داده‌های فروشگاه Zava Retail تاکوما |
| **اسپوکن** | `d8e9f0a1-b2c3-4567-8901-234567890abc` | داده‌های فروشگاه Zava Retail اسپوکن |
| **اورت** | `3b9ac9fa-cd5e-4b92-a7f2-b8c1d0e9f2a3` | داده‌های فروشگاه Zava Retail اورت |
| **ردموند** | `e7f8a9b0-c1d2-3e4f-5678-90abcdef1234` | داده‌های فروشگاه Zava Retail ردموند |
| **کرکلند** | `9c8b7a65-4321-fed0-9876-543210fedcba` | داده‌های فروشگاه Zava Retail کرکلند |
| **آنلاین** | `2f4e6d8c-1a3b-5c7e-9f0a-b2d4f6e8c0a2` | داده‌های فروشگاه آنلاین Zava Retail |

#### پیاده‌سازی RLS

وقتی یک کاربر با شناسه کاربری RLS مخصوص یک فروشگاه متصل می‌شود، فقط موارد زیر را مشاهده خواهد کرد:

- مشتریان مرتبط با آن فروشگاه
- سفارش‌هایی که در مکان آن فروشگاه ثبت شده‌اند
- داده‌های موجودی برای آن فروشگاه خاص
- معیارهای فروش و عملکرد مخصوص فروشگاه

این امر جداسازی داده‌ها بین مکان‌های مختلف فروشگاه را تضمین می‌کند در حالی که یک طرح پایگاه داده یکپارچه حفظ می‌شود.

## معماری

### زمینه برنامه

سرور از یک زمینه برنامه مدیریت‌شده استفاده می‌کند با:

- **استخر اتصال پایگاه داده**: مدیریت اتصال کارآمد برای حالت HTTP
- **مدیریت چرخه عمر**: پاکسازی مناسب منابع هنگام خاموش شدن
- **ایمنی نوع**: زمینه به‌طور قوی تایپ‌شده با کلاس داده `AppContext`

### زمینه درخواست

- **استخراج هدر**: تجزیه امن هدر برای شناسایی کاربر
- **یکپارچه‌سازی RLS**: حل خودکار شناسه کاربری از زمینه درخواست
- **مدیریت خطا**: مدیریت جامع خطا با پیام‌های کاربرپسند

## یکپارچه‌سازی پایگاه داده

سرور با پایگاه داده PostgreSQL از طریق کلاس `PostgreSQLSchemaProvider` یکپارچه می‌شود:

- **استخر اتصال**: از استخرهای اتصال غیرهمزمان برای مقیاس‌پذیری استفاده می‌کند
- **فرا‌داده طرح**: اطلاعات دقیق طرح جدول فراهم می‌کند
- **اجرای پرس‌وجو**: اجرای امن پرس‌وجو با پشتیبانی از RLS
- **مدیریت منابع**: پاکسازی خودکار منابع پایگاه داده

## مدیریت خطا

سرور مدیریت خطای قوی اجرا می‌کند:

- **اعتبارسنجی جدول**: اطمینان حاصل می‌کند که فقط نام‌های جدول معتبر دسترسی پیدا می‌کنند
- **اعتبارسنجی پرس‌وجو**: پرس‌وجوهای PostgreSQL را قبل از اجرا اعتبارسنجی می‌کند
- **مدیریت منابع**: پاکسازی مناسب حتی در هنگام خطا
- **پیام‌های کاربرپسند**: پیام‌های خطای واضح برای رفع اشکال

## ملاحظات امنیتی

1. **امنیت سطح ردیف**: تمام پرس‌وجوها سیاست‌های RLS را بر اساس هویت کاربر رعایت می‌کنند
2. **جداسازی داده‌های فروشگاه**: شناسه کاربری RLS هر فروشگاه دسترسی فقط به داده‌های آن فروشگاه را تضمین می‌کند
3. **اعتبارسنجی ورودی**: نام‌های جدول و پرس‌وجوها قبل از اجرا اعتبارسنجی می‌شوند
4. **محدودیت منابع**: نتایج پرس‌وجو محدود شده‌اند تا از استفاده بیش از حد منابع جلوگیری شود
5. **امنیت اتصال**: از روش‌های امن اتصال پایگاه داده استفاده می‌کند
6. **تأیید هویت کاربر**: همیشه اطمینان حاصل کنید که شناسه کاربری RLS صحیح برای مکان مورد نظر فروشگاه استفاده می‌شود

### نکات مهم امنیتی

- **هرگز از شناسه‌های کاربری RLS تولید در محیط‌های توسعه استفاده نکنید**
- **همیشه تأیید کنید که شناسه کاربری RLS با فروشگاه مورد نظر مطابقت دارد قبل از اجرای پرس‌وجوها**
- **UUID پیش‌فرض (`00000000-0000-0000-0000-000000000000`) دسترسی محدود فراهم می‌کند**
- **هر مدیر فروشگاه فقط باید به شناسه کاربری RLS فروشگاه خود دسترسی داشته باشد**

## توسعه

### ساختار پروژه

```text
mcp_server/
├── sales_analysis.py          # Main MCP server implementation
├── sales_analysis_postgres.py # PostgreSQL integration layer
├── sales_analysis_text_embedding.py # Text embedding for semantic search tool
```

### اجزای کلیدی

- **سرور FastMCP**: پیاده‌سازی مدرن سرور MCP با پشتیبانی غیرهمزمان
- **ارائه‌دهنده PostgreSQL**: لایه انتزاع پایگاه داده با پشتیبانی از RLS
- **مدیریت زمینه**: مدیریت زمینه برنامه و درخواست به‌طور ایمن تایپ‌شده
- **ثبت ابزار**: ثبت ابزار به‌صورت اعلامی با اعتبارسنجی Pydantic

## مشارکت

هنگام مشارکت در این سرور:

1. اطمینان حاصل کنید که تمام پرس‌وجوهای پایگاه داده سیاست‌های امنیت سطح ردیف را رعایت می‌کنند
2. مدیریت خطای مناسب برای ابزارهای جدید اضافه کنید
3. این README را با هر ویژگی یا تغییر جدید به‌روزرسانی کنید
4. حالت سرور HTTP را آزمایش کنید
5. پارامترهای ورودی را اعتبارسنجی کنید و پیام‌های خطای واضح ارائه دهید

## [مجوز](https://github.com/microsoft/MCP-Server-and-PostgreSQL-Sample-Retail/blob/main/LICENSE)

---

*این سرور MCP دسترسی امن و کارآمد به داده‌های فروش Zava Retail را برای تحلیل و بینش‌های مبتنی بر هوش مصنوعی فراهم می‌کند.*

---

**سلب مسئولیت**:  
این سند با استفاده از سرویس ترجمه هوش مصنوعی [Co-op Translator](https://github.com/Azure/co-op-translator) ترجمه شده است. در حالی که ما تلاش می‌کنیم دقت را رعایت کنیم، لطفاً توجه داشته باشید که ترجمه‌های خودکار ممکن است شامل خطاها یا نادرستی‌هایی باشند. سند اصلی به زبان اصلی آن باید به عنوان منبع معتبر در نظر گرفته شود. برای اطلاعات حساس، ترجمه انسانی حرفه‌ای توصیه می‌شود. ما هیچ مسئولیتی در قبال سوءتفاهم‌ها یا تفسیرهای نادرست ناشی از استفاده از این ترجمه نداریم.