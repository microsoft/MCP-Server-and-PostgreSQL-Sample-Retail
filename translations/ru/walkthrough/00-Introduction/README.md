<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "4a903b684f72790625340375b1a033c6",
  "translation_date": "2025-09-29T18:57:10+00:00",
  "source_file": "walkthrough/00-Introduction/README.md",
  "language_code": "ru"
}
-->
# Введение в интеграцию базы данных MCP

## 🎯 Что охватывает этот модуль

Этот вводный модуль предоставляет подробный обзор создания серверов Model Context Protocol (MCP) с интеграцией базы данных. Вы узнаете о бизнес-кейсе, технической архитектуре и реальных приложениях на примере аналитики Zava Retail.

## Обзор

**Model Context Protocol (MCP)** позволяет AI-ассистентам безопасно получать доступ к внешним источникам данных и взаимодействовать с ними в режиме реального времени. В сочетании с интеграцией базы данных MCP открывает мощные возможности для приложений, основанных на данных.

Этот учебный курс научит вас создавать готовые к производству серверы MCP, которые подключают AI-ассистентов к данным о продажах в розничной торговле через PostgreSQL, реализуя корпоративные шаблоны, такие как управление доступом на уровне строк, семантический поиск и многопользовательский доступ к данным.

## Цели обучения

К концу этого модуля вы сможете:

- **Определить** Model Context Protocol и его основные преимущества для интеграции базы данных
- **Выделить** ключевые компоненты архитектуры сервера MCP с базами данных
- **Понять** кейс Zava Retail и его бизнес-требования
- **Распознать** корпоративные шаблоны для безопасного и масштабируемого доступа к данным
- **Перечислить** инструменты и технологии, используемые в этом учебном курсе

## 🧭 Проблема: AI и данные реального мира

### Ограничения традиционного AI

Современные AI-ассистенты невероятно мощны, но сталкиваются с серьезными ограничениями при работе с реальными бизнес-данными:

| **Проблема**         | **Описание**                                   | **Влияние на бизнес**                |
|-----------------------|-----------------------------------------------|---------------------------------------|
| **Статические знания** | AI-модели, обученные на фиксированных наборах данных, не могут получать доступ к актуальным бизнес-данным | Устаревшие инсайты, упущенные возможности |
| **Изолированные данные** | Информация, заблокированная в базах данных, API и системах, недоступных AI | Неполный анализ, фрагментированные рабочие процессы |
| **Ограничения безопасности** | Прямой доступ к базе данных вызывает проблемы безопасности и соответствия требованиям | Ограниченное развертывание, ручная подготовка данных |
| **Сложные запросы**    | Бизнес-пользователям требуется техническое знание для извлечения данных | Снижение уровня принятия, неэффективные процессы |

### Решение MCP

Model Context Protocol решает эти проблемы, предоставляя:

- **Доступ к данным в реальном времени**: AI-ассистенты запрашивают актуальные базы данных и API
- **Безопасную интеграцию**: Контролируемый доступ с аутентификацией и разрешениями
- **Интерфейс на естественном языке**: Бизнес-пользователи задают вопросы на простом английском
- **Стандартизированный протокол**: Работает на разных платформах и инструментах AI

## 🏪 Знакомьтесь: Zava Retail — наш учебный кейс

На протяжении этого учебного курса мы будем создавать сервер MCP для **Zava Retail**, вымышленной сети магазинов DIY с несколькими точками продаж. Этот реалистичный сценарий демонстрирует корпоративную реализацию MCP.

### Бизнес-контекст

**Zava Retail** управляет:
- **8 физическими магазинами** в штате Вашингтон (Сиэтл, Белвью, Такома, Спокан, Эверетт, Редмонд, Киркленд)
- **1 онлайн-магазином** для электронной коммерции
- **Разнообразным каталогом товаров**, включая инструменты, оборудование, садовые принадлежности и строительные материалы
- **Многоуровневым управлением** с менеджерами магазинов, региональными менеджерами и руководителями

### Бизнес-требования

Менеджерам магазинов и руководителям нужны аналитические инструменты на базе AI для:

1. **Анализа продаж** по магазинам и временным периодам
2. **Отслеживания уровня запасов** и выявления потребностей в пополнении
3. **Понимания поведения клиентов** и их покупательских привычек
4. **Получения информации о товарах** через семантический поиск
5. **Генерации отчетов** с помощью запросов на естественном языке
6. **Обеспечения безопасности данных** с помощью управления доступом на основе ролей

### Технические требования

Сервер MCP должен предоставлять:

- **Многопользовательский доступ к данным**, где менеджеры магазинов видят только данные своего магазина
- **Гибкие запросы**, поддерживающие сложные SQL-операции
- **Семантический поиск** для обнаружения товаров и рекомендаций
- **Данные в реальном времени**, отражающие текущую бизнес-ситуацию
- **Безопасную аутентификацию** с управлением доступом на уровне строк
- **Масштабируемую архитектуру**, поддерживающую множество пользователей одновременно

## 🏗️ Обзор архитектуры сервера MCP

Наш сервер MCP реализует многослойную архитектуру, оптимизированную для интеграции базы данных:

```
┌─────────────────────────────────────────────────────────────┐
│                    VS Code AI Client                       │
│                  (Natural Language Queries)                │
└─────────────────────┬───────────────────────────────────────┘
                      │ HTTP/SSE
                      ▼
┌─────────────────────────────────────────────────────────────┐
│                     MCP Server                             │
│  ┌─────────────────┐ ┌─────────────────┐ ┌───────────────┐ │
│  │   Tool Layer    │ │  Security Layer │ │  Config Layer │ │
│  │                 │ │                 │ │               │ │
│  │ • Query Tools   │ │ • RLS Context   │ │ • Environment │ │
│  │ • Schema Tools  │ │ • User Identity │ │ • Connections │ │
│  │ • Search Tools  │ │ • Access Control│ │ • Validation  │ │
│  └─────────────────┘ └─────────────────┘ └───────────────┘ │
└─────────────────────┬───────────────────────────────────────┘
                      │ asyncpg
                      ▼
┌─────────────────────────────────────────────────────────────┐
│                PostgreSQL Database                         │
│  ┌─────────────────┐ ┌─────────────────┐ ┌───────────────┐ │
│  │  Retail Schema  │ │   RLS Policies  │ │   pgvector    │ │
│  │                 │ │                 │ │               │ │
│  │ • Stores        │ │ • Store-based   │ │ • Embeddings  │ │
│  │ • Customers     │ │   Isolation     │ │ • Similarity  │ │
│  │ • Products      │ │ • Role Control  │ │   Search      │ │
│  │ • Orders        │ │ • Audit Logs    │ │               │ │
│  └─────────────────┘ └─────────────────┘ └───────────────┘ │
└─────────────────────┬───────────────────────────────────────┘
                      │ REST API
                      ▼
┌─────────────────────────────────────────────────────────────┐
│                  Azure OpenAI                              │
│               (Text Embeddings)                            │
└─────────────────────────────────────────────────────────────┘
```

### Основные компоненты

#### **1. Слой сервера MCP**
- **FastMCP Framework**: Современная реализация сервера MCP на Python
- **Регистрация инструментов**: Декларативное определение инструментов с проверкой типов
- **Контекст запросов**: Управление идентификацией пользователя и сессиями
- **Обработка ошибок**: Надежное управление ошибками и логирование

#### **2. Слой интеграции базы данных**
- **Пул соединений**: Эффективное управление соединениями asyncpg
- **Поставщик схем**: Динамическое обнаружение схем таблиц
- **Исполнитель запросов**: Безопасное выполнение SQL с контекстом RLS
- **Управление транзакциями**: Соответствие ACID и обработка откатов

#### **3. Слой безопасности**
- **Управление доступом на уровне строк**: PostgreSQL RLS для изоляции данных
- **Идентификация пользователя**: Аутентификация и авторизация менеджеров магазинов
- **Контроль доступа**: Тонкая настройка разрешений и аудит
- **Валидация ввода**: Предотвращение SQL-инъекций и проверка запросов

#### **4. Слой улучшения AI**
- **Семантический поиск**: Векторные представления для обнаружения товаров
- **Интеграция Azure OpenAI**: Генерация текстовых векторных представлений
- **Алгоритмы сходства**: Поиск сходства с помощью pgvector
- **Оптимизация поиска**: Индексация и настройка производительности

## 🔧 Технологический стек

### Основные технологии

| **Компонент**         | **Технология**            | **Назначение**                     |
|-----------------------|--------------------------|-------------------------------------|
| **Фреймворк MCP**      | FastMCP (Python)         | Современная реализация сервера MCP |
| **База данных**        | PostgreSQL 17 + pgvector | Реляционные данные с векторным поиском |
| **AI-сервисы**         | Azure OpenAI             | Текстовые представления и языковые модели |
| **Контейнеризация**    | Docker + Docker Compose  | Среда разработки                   |
| **Облачная платформа** | Microsoft Azure          | Развертывание в производстве       |
| **Интеграция IDE**     | VS Code                  | AI-чат и рабочий процесс разработки |

### Инструменты разработки

| **Инструмент** | **Назначение**                  |
|----------------|---------------------------------|
| **asyncpg**    | Высокопроизводительный драйвер PostgreSQL |
| **Pydantic**   | Валидация и сериализация данных |
| **Azure SDK**  | Интеграция облачных сервисов    |
| **pytest**     | Фреймворк для тестирования      |
| **Docker**     | Контейнеризация и развертывание |

### Производственный стек

| **Сервис**     | **Ресурс Azure**               | **Назначение**                     |
|----------------|-------------------------------|-------------------------------------|
| **База данных** | Azure Database for PostgreSQL | Управляемый сервис базы данных     |
| **Контейнер**   | Azure Container Apps          | Хостинг контейнеров без сервера    |
| **AI-сервисы**  | Azure AI Foundry              | Модели OpenAI и конечные точки     |
| **Мониторинг**  | Application Insights          | Наблюдаемость и диагностика        |
| **Безопасность**| Azure Key Vault               | Управление секретами и конфигурацией |

## 🎬 Сценарии использования в реальном мире

Давайте рассмотрим, как разные пользователи взаимодействуют с нашим сервером MCP:

### Сценарий 1: Анализ эффективности менеджера магазина

**Пользователь**: Сара, менеджер магазина в Сиэтле  
**Цель**: Анализировать продажи за последний квартал

**Запрос на естественном языке**:
> "Покажите мне 10 лучших товаров по доходу для моего магазина в 4 квартале 2024 года"

**Что происходит**:
1. AI-чат в VS Code отправляет запрос на сервер MCP
2. Сервер MCP определяет контекст магазина Сары (Сиэтл)
3. Политики RLS фильтруют данные только для магазина в Сиэтле
4. Генерируется и выполняется SQL-запрос
5. Результаты форматируются и возвращаются в AI-чат
6. AI предоставляет анализ и инсайты

### Сценарий 2: Поиск товаров с помощью семантического поиска

**Пользователь**: Майк, менеджер по инвентаризации  
**Цель**: Найти товары, похожие на запрос клиента

**Запрос на естественном языке**:
> "Какие товары мы продаем, похожие на 'водонепроницаемые электрические соединители для использования на улице'?"

**Что происходит**:
1. Запрос обрабатывается инструментом семантического поиска
2. Azure OpenAI генерирует векторное представление
3. pgvector выполняет поиск сходства
4. Похожие товары ранжируются по релевантности
5. Результаты включают детали товаров и их доступность
6. AI предлагает альтернативы и возможности для комплектования

### Сценарий 3: Аналитика по всем магазинам

**Пользователь**: Дженнифер, региональный менеджер  
**Цель**: Сравнить эффективность всех магазинов

**Запрос на естественном языке**:
> "Сравните продажи по категориям для всех магазинов за последние 6 месяцев"

**Что происходит**:
1. Контекст RLS устанавливается для доступа регионального менеджера
2. Генерируется сложный запрос для всех магазинов
3. Данные агрегируются по местоположениям магазинов
4. Результаты включают тренды и сравнения
5. AI выявляет инсайты и рекомендации

## 🔒 Углубление в безопасность и многопользовательский доступ

Наша реализация уделяет первостепенное внимание безопасности корпоративного уровня:

### Управление доступом на уровне строк (RLS)

PostgreSQL RLS обеспечивает изоляцию данных:

```sql
-- Store managers see only their store's data
CREATE POLICY store_manager_policy ON retail.orders
  FOR ALL TO store_managers
  USING (store_id = get_current_user_store());

-- Regional managers see multiple stores
CREATE POLICY regional_manager_policy ON retail.orders
  FOR ALL TO regional_managers
  USING (store_id = ANY(get_user_store_list()));
```

### Управление идентификацией пользователя

Каждое соединение MCP включает:
- **ID менеджера магазина**: Уникальный идентификатор для контекста RLS
- **Назначение ролей**: Разрешения и уровни доступа
- **Управление сессиями**: Безопасные токены аутентификации
- **Логирование аудита**: Полная история доступа

### Защита данных

Многоуровневая безопасность:
- **Шифрование соединений**: TLS для всех соединений с базой данных
- **Предотвращение SQL-инъекций**: Только параметризованные запросы
- **Валидация ввода**: Комплексная проверка запросов
- **Обработка ошибок**: Без утечки конфиденциальных данных в сообщениях об ошибках

## 🎯 Основные выводы

После завершения этого введения вы должны понимать:

✅ **Ценность MCP**: Как MCP соединяет AI-ассистентов и данные реального мира  
✅ **Бизнес-контекст**: Требования и вызовы Zava Retail  
✅ **Обзор архитектуры**: Основные компоненты и их взаимодействие  
✅ **Технологический стек**: Инструменты и фреймворки, используемые в курсе  
✅ **Модель безопасности**: Многопользовательский доступ к данным и их защита  
✅ **Шаблоны использования**: Сценарии запросов и рабочие процессы в реальном мире  

## 🚀 Что дальше

Готовы углубиться? Продолжайте с:

**[Модуль 01: Основные концепции архитектуры](../01-Architecture/README.md)**

Узнайте о шаблонах архитектуры серверов MCP, принципах проектирования баз данных и подробной технической реализации, которая лежит в основе нашего решения для аналитики в розничной торговле.

## 📚 Дополнительные ресурсы

### Документация MCP
- [Спецификация MCP](https://modelcontextprotocol.io/docs/) — официальная документация протокола
- [MCP для начинающих](https://aka.ms/mcp-for-beginners) — подробное руководство по MCP
- [Документация FastMCP](https://github.com/modelcontextprotocol/python-sdk) — документация Python SDK

### Интеграция базы данных
- [Документация PostgreSQL](https://www.postgresql.org/docs/) — полное руководство по PostgreSQL
- [Руководство pgvector](https://github.com/pgvector/pgvector) — документация расширения для работы с векторами
- [Управление доступом на уровне строк](https://www.postgresql.org/docs/current/ddl-rowsecurity.html) — руководство PostgreSQL RLS

### Сервисы Azure
- [Документация Azure OpenAI](https://docs.microsoft.com/azure/cognitive-services/openai/) — интеграция AI-сервисов
- [Azure Database for PostgreSQL](https://docs.microsoft.com/azure/postgresql/) — управляемый сервис базы данных
- [Azure Container Apps](https://docs.microsoft.com/azure/container-apps/) — контейнеры без сервера

---

**Отказ от ответственности**: Это учебное упражнение с использованием вымышленной розничной информации. Всегда следуйте политике вашей организации в области управления данными и безопасности при реализации подобных решений в производственной среде.

---

**Отказ от ответственности**:  
Этот документ был переведен с помощью сервиса автоматического перевода [Co-op Translator](https://github.com/Azure/co-op-translator). Несмотря на наши усилия обеспечить точность, автоматические переводы могут содержать ошибки или неточности. Оригинальный документ на его родном языке следует считать авторитетным источником. Для получения критически важной информации рекомендуется профессиональный перевод человеком. Мы не несем ответственности за любые недоразумения или неправильные интерпретации, возникшие в результате использования данного перевода.