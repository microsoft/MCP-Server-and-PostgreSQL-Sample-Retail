<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "4a903b684f72790625340375b1a033c6",
  "translation_date": "2025-09-30T07:19:14+00:00",
  "source_file": "walkthrough/00-Introduction/README.md",
  "language_code": "bg"
}
-->
# Въведение в интеграцията на MCP с база данни

## 🎯 Какво обхваща този модул

Този въвеждащ модул предоставя цялостен преглед на изграждането на сървъри с Model Context Protocol (MCP) и интеграция с база данни. Ще разберете бизнес казуса, техническата архитектура и реалните приложения чрез примера за анализи в Zava Retail.

## Общ преглед

**Model Context Protocol (MCP)** позволява на AI асистентите сигурно да достъпват и взаимодействат с външни източници на данни в реално време. Когато се комбинира с интеграция на база данни, MCP отключва мощни възможности за приложения, базирани на данни.

Този учебен път ви учи как да изградите готови за производство MCP сървъри, които свързват AI асистенти с данни за продажби в търговията на дребно чрез PostgreSQL, като прилагате корпоративни модели като Row Level Security, семантично търсене и достъп до данни за множество наематели.

## Цели на обучението

До края на този модул ще можете:

- **Да дефинирате** Model Context Protocol и основните му предимства за интеграция с база данни
- **Да идентифицирате** ключовите компоненти на архитектурата на MCP сървър с база данни
- **Да разберете** казуса на Zava Retail и неговите бизнес изисквания
- **Да разпознаете** корпоративни модели за сигурен и мащабируем достъп до база данни
- **Да изброите** инструментите и технологиите, използвани в този учебен път

## 🧭 Предизвикателството: AI среща реални данни

### Ограничения на традиционния AI

Съвременните AI асистенти са изключително мощни, но срещат значителни ограничения при работа с реални бизнес данни:

| **Предизвикателство** | **Описание** | **Бизнес въздействие** |
|------------------------|--------------|-------------------------|
| **Статични знания** | AI модели, обучени на фиксирани набори от данни, не могат да достъпват текущи бизнес данни | Остарели прозрения, пропуснати възможности |
| **Силози от данни** | Информацията е заключена в бази данни, API и системи, които AI не може да достигне | Непълни анализи, фрагментирани работни потоци |
| **Ограничения за сигурност** | Директният достъп до база данни поражда проблеми със сигурността и съответствието | Ограничено внедряване, ръчна подготовка на данни |
| **Сложни заявки** | Бизнес потребителите се нуждаят от технически знания, за да извличат данни | Намалено приемане, неефективни процеси |

### Решението MCP

Model Context Protocol адресира тези предизвикателства, като предоставя:

- **Достъп до данни в реално време**: AI асистентите правят заявки към живи бази данни и API
- **Сигурна интеграция**: Контролиран достъп с автентикация и разрешения
- **Интерфейс на естествен език**: Бизнес потребителите задават въпроси на обикновен английски
- **Стандартизиран протокол**: Работи с различни AI платформи и инструменти

## 🏪 Запознайте се със Zava Retail: Нашето учебно казус

През целия учебен път ще изградим MCP сървър за **Zava Retail**, измислена верига за търговия на дребно с множество магазини. Този реалистичен сценарий демонстрира корпоративно внедряване на MCP.

### Бизнес контекст

**Zava Retail** оперира:
- **8 физически магазина** в щата Вашингтон (Сиатъл, Белвю, Такома, Спокейн, Еверет, Редмънд, Къркланд)
- **1 онлайн магазин** за електронна търговия
- **Разнообразен продуктов каталог**, включващ инструменти, хардуер, градински материали и строителни материали
- **Многостепенно управление** с управители на магазини, регионални мениджъри и ръководители

### Бизнес изисквания

Управителите на магазини и ръководителите се нуждаят от AI-базирани анализи за:

1. **Анализ на продажбите** в различни магазини и периоди
2. **Проследяване на наличностите** и идентифициране на нуждите от презареждане
3. **Разбиране на поведението на клиентите** и моделите на покупки
4. **Откриване на продуктови прозрения** чрез семантично търсене
5. **Генериране на отчети** с естествени езикови заявки
6. **Поддържане на сигурността на данните** с контрол на достъпа, базиран на роли

### Технически изисквания

MCP сървърът трябва да предоставя:

- **Достъп до данни за множество наематели**, където управителите на магазини виждат само данните за своя магазин
- **Гъвкаво изпълнение на заявки**, поддържащо сложни SQL операции
- **Семантично търсене** за откриване на продукти и препоръки
- **Данни в реално време**, отразяващи текущото състояние на бизнеса
- **Сигурна автентикация** с контекст на Row Level Security
- **Мащабируема архитектура**, поддържаща множество едновременни потребители

## 🏗️ Преглед на архитектурата на MCP сървър

Нашият MCP сървър прилага слоеста архитектура, оптимизирана за интеграция с база данни:

```
┌─────────────────────────────────────────────────────────────┐
│                    VS Code AI Client                       │
│                  (Natural Language Queries)                │
└─────────────────────┬───────────────────────────────────────┘
                      │ HTTP/SSE
                      ▼
┌─────────────────────────────────────────────────────────────┐
│                     MCP Server                             │
│  ┌─────────────────┐ ┌─────────────────┐ ┌───────────────┐ │
│  │   Tool Layer    │ │  Security Layer │ │  Config Layer │ │
│  │                 │ │                 │ │               │ │
│  │ • Query Tools   │ │ • RLS Context   │ │ • Environment │ │
│  │ • Schema Tools  │ │ • User Identity │ │ • Connections │ │
│  │ • Search Tools  │ │ • Access Control│ │ • Validation  │ │
│  └─────────────────┘ └─────────────────┘ └───────────────┘ │
└─────────────────────┬───────────────────────────────────────┘
                      │ asyncpg
                      ▼
┌─────────────────────────────────────────────────────────────┐
│                PostgreSQL Database                         │
│  ┌─────────────────┐ ┌─────────────────┐ ┌───────────────┐ │
│  │  Retail Schema  │ │   RLS Policies  │ │   pgvector    │ │
│  │                 │ │                 │ │               │ │
│  │ • Stores        │ │ • Store-based   │ │ • Embeddings  │ │
│  │ • Customers     │ │   Isolation     │ │ • Similarity  │ │
│  │ • Products      │ │ • Role Control  │ │   Search      │ │
│  │ • Orders        │ │ • Audit Logs    │ │               │ │
│  └─────────────────┘ └─────────────────┘ └───────────────┘ │
└─────────────────────┬───────────────────────────────────────┘
                      │ REST API
                      ▼
┌─────────────────────────────────────────────────────────────┐
│                  Azure OpenAI                              │
│               (Text Embeddings)                            │
└─────────────────────────────────────────────────────────────┘
```

### Ключови компоненти

#### **1. Слой на MCP сървър**
- **FastMCP Framework**: Модерна Python имплементация на MCP сървър
- **Регистрация на инструменти**: Декларативни дефиниции на инструменти с типова безопасност
- **Контекст на заявката**: Управление на идентичността на потребителя и сесията
- **Управление на грешки**: Надеждно управление на грешки и логване

#### **2. Слой за интеграция с база данни**
- **Управление на връзки**: Ефективно управление на asyncpg връзки
- **Доставчик на схеми**: Динамично откриване на таблици и схеми
- **Изпълнител на заявки**: Сигурно изпълнение на SQL с контекст на RLS
- **Управление на транзакции**: Съответствие с ACID и обработка на отмяна

#### **3. Слой за сигурност**
- **Row Level Security**: PostgreSQL RLS за изолация на данни за множество наематели
- **Идентичност на потребителя**: Автентикация и авторизация на управителите на магазини
- **Контрол на достъпа**: Фино настроени разрешения и следи за одит
- **Валидиране на входа**: Предотвратяване на SQL инжекции и валидиране на заявки

#### **4. Слой за AI подобрения**
- **Семантично търсене**: Векторни вграждания за откриване на продукти
- **Интеграция с Azure OpenAI**: Генериране на текстови вграждания
- **Алгоритми за сходство**: pgvector търсене по косинусова сходство
- **Оптимизация на търсенето**: Индексиране и настройка на производителността

## 🔧 Технологичен стек

### Основни технологии

| **Компонент** | **Технология** | **Цел** |
|---------------|----------------|---------|
| **MCP Framework** | FastMCP (Python) | Модерна имплементация на MCP сървър |
| **База данни** | PostgreSQL 17 + pgvector | Релационни данни с векторно търсене |
| **AI услуги** | Azure OpenAI | Текстови вграждания и езикови модели |
| **Контейнеризация** | Docker + Docker Compose | Среда за разработка |
| **Облачна платформа** | Microsoft Azure | Внедряване в продукция |
| **Интеграция с IDE** | VS Code | AI чат и работен процес за разработка |

### Инструменти за разработка

| **Инструмент** | **Цел** |
|----------------|---------|
| **asyncpg** | Високопроизводителен PostgreSQL драйвер |
| **Pydantic** | Валидиране и сериализация на данни |
| **Azure SDK** | Интеграция с облачни услуги |
| **pytest** | Рамка за тестване |
| **Docker** | Контейнеризация и внедряване |

### Производствен стек

| **Услуга** | **Azure ресурс** | **Цел** |
|------------|------------------|---------|
| **База данни** | Azure Database for PostgreSQL | Управлявана услуга за база данни |
| **Контейнер** | Azure Container Apps | Хостинг на безсървърни контейнери |
| **AI услуги** | Azure AI Foundry | OpenAI модели и крайни точки |
| **Мониторинг** | Application Insights | Наблюдение и диагностика |
| **Сигурност** | Azure Key Vault | Управление на тайни и конфигурации |

## 🎬 Реални сценарии за употреба

Нека разгледаме как различни потребители взаимодействат с нашия MCP сървър:

### Сценарий 1: Преглед на представянето на магазина

**Потребител**: Сара, управител на магазина в Сиатъл  
**Цел**: Анализ на представянето на продажбите за последното тримесечие

**Заявка на естествен език**:
> "Покажи ми топ 10 продукти по приходи за моя магазин през Q4 2024"

**Какво се случва**:
1. VS Code AI Chat изпраща заявката към MCP сървъра
2. MCP сървърът идентифицира контекста на магазина на Сара (Сиатъл)
3. RLS политиките филтрират данните само за магазина в Сиатъл
4. SQL заявката се генерира и изпълнява
5. Резултатите се форматират и връщат към AI Chat
6. AI предоставя анализ и прозрения

### Сценарий 2: Откриване на продукти със семантично търсене

**Потребител**: Майк, мениджър на наличностите  
**Цел**: Намиране на продукти, подобни на клиентска заявка

**Заявка на естествен език**:
> "Какви продукти продаваме, които са подобни на 'водоустойчиви електрически конектори за външна употреба'?"

**Какво се случва**:
1. Заявката се обработва от инструмента за семантично търсене
2. Azure OpenAI генерира векторно вграждане
3. pgvector изпълнява търсене по сходство
4. Свързаните продукти се класират по релевантност
5. Резултатите включват детайли за продуктите и наличност
6. AI предлага алтернативи и възможности за пакетиране

### Сценарий 3: Анализ между магазини

**Потребител**: Дженифър, регионален мениджър  
**Цел**: Сравнение на представянето между всички магазини

**Заявка на естествен език**:
> "Сравни продажбите по категории за всички магазини през последните 6 месеца"

**Какво се случва**:
1. RLS контекстът се задава за достъп на регионален мениджър
2. Генерира се сложна заявка за множество магазини
3. Данните се агрегират между локациите на магазините
4. Резултатите включват тенденции и сравнения
5. AI идентифицира прозрения и препоръки

## 🔒 Задълбочен поглед върху сигурността и достъпа за множество наематели

Нашата имплементация приоритизира сигурността на корпоративно ниво:

### Row Level Security (RLS)

PostgreSQL RLS осигурява изолация на данните:

```sql
-- Store managers see only their store's data
CREATE POLICY store_manager_policy ON retail.orders
  FOR ALL TO store_managers
  USING (store_id = get_current_user_store());

-- Regional managers see multiple stores
CREATE POLICY regional_manager_policy ON retail.orders
  FOR ALL TO regional_managers
  USING (store_id = ANY(get_user_store_list()));
```

### Управление на идентичността на потребителя

Всяка връзка с MCP включва:
- **ID на управителя на магазина**: Уникален идентификатор за контекста на RLS
- **Присвояване на роли**: Разрешения и нива на достъп
- **Управление на сесии**: Сигурни токени за автентикация
- **Логване на одит**: Пълна история на достъпа

### Защита на данните

Множество слоеве на сигурност:
- **Шифроване на връзката**: TLS за всички връзки към базата данни
- **Предотвратяване на SQL инжекции**: Само параметризирани заявки
- **Валидиране на входа**: Цялостно валидиране на заявките
- **Управление на грешки**: Без чувствителни данни в съобщенията за грешки

## 🎯 Основни изводи

След завършване на това въведение трябва да разбирате:

✅ **Стойността на MCP**: Как MCP свързва AI асистентите с реални данни  
✅ **Бизнес контекст**: Изискванията и предизвикателствата на Zava Retail  
✅ **Преглед на архитектурата**: Ключовите компоненти и техните взаимодействия  
✅ **Технологичен стек**: Инструментите и рамките, използвани в целия процес  
✅ **Модел за сигурност**: Достъп до данни за множество наематели и защита  
✅ **Модели на употреба**: Реални сценарии за заявки и работни потоци  

## 🚀 Какво следва

Готови ли сте за по-задълбочено изучаване? Продължете с:

**[Модул 01: Основни концепции за архитектура](../01-Architecture/README.md)**

Научете за моделите на архитектурата на MCP сървър, принципите на дизайн на бази данни и подробната техническа имплементация, която захранва нашето решение за анализи в търговията на дребно.

## 📚 Допълнителни ресурси

### MCP документация
- [MCP Спецификация](https://modelcontextprotocol.io/docs/) - Официална документация на протокола
- [MCP за начинаещи](https://aka.ms/mcp-for-beginners) - Цялостен учебен наръчник за MCP
- [FastMCP документация](https://github.com/modelcontextprotocol/python-sdk) - Документация за Python SDK

### Интеграция с база данни
- [PostgreSQL документация](https://www.postgresql.org/docs/) - Пълна справка за PostgreSQL
- [pgvector ръководство](https://github.com/pgvector/pgvector) - Документация за векторното разширение
- [Row Level Security](https://www.postgresql.org/docs/current/ddl-rowsecurity.html) - Ръководство за PostgreSQL RLS

### Azure услуги
- [Azure OpenAI документация](https://docs.microsoft.com/azure/cognitive-services/openai/) - Интеграция с AI услуги
- [Azure Database for PostgreSQL](https://docs.microsoft.com/azure/postgresql/) - Управлявана услуга за база данни
- [Azure Container Apps](https://docs.microsoft.com/azure/container-apps/) - Безсървърни контейнери

---

**Отказ от отговорност**: Това е учебно упражнение с измислени данни за търговия на дребно. Винаги следвайте политиките за управление и сигурност на данните на вашата организация при внедряване на подобни решения в производствени среди.

---

**Отказ от отговорност**:  
Този документ е преведен с помощта на AI услуга за превод [Co-op Translator](https://github.com/Azure/co-op-translator). Въпреки че се стремим към точност, моля, имайте предвид, че автоматизираните преводи може да съдържат грешки или неточности. Оригиналният документ на неговия роден език трябва да се счита за авторитетен източник. За критична информация се препоръчва професионален човешки превод. Не носим отговорност за недоразумения или погрешни интерпретации, произтичащи от използването на този превод.