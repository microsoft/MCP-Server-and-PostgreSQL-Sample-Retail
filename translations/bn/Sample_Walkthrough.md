<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "c86955fe1dbaafcb4540d8875649e2f5",
  "translation_date": "2025-09-29T19:43:03+00:00",
  "source_file": "Sample_Walkthrough.md",
  "language_code": "bn"
}
-->
# MCP рж╕рж╛рж░рзНржнрж╛рж░ ржПржмржВ PostgreSQL ржиржорзБржирж╛ - рж╕ржорзНржкрзВрж░рзНржг ржирж┐рж░рзНржжрзЗрж╢рж┐ржХрж╛

## рж╕рзВржЪрж┐ржкрждрзНрж░
1. [ржкрж░рзНржпрж╛рж▓рзЛржЪржирж╛](../..)
2. [рж╕рзНржерж╛ржкрждрзНржп ржмрж┐рж╢рзНрж▓рзЗрж╖ржг](../..)
3. [рж╕ржорж╛ржзрж╛ржи рждрзИрж░рж┐](../..)
4. [ржЙржкрж╛ржжрж╛ржи ржмрж┐рж╢рзНрж▓рзЗрж╖ржг](../..)
5. [ржорзЛрждрж╛ржпрж╝рзЗржи ржирж┐рж░рзНржжрзЗрж╢рж┐ржХрж╛](../..)
6. [рж╕ржорж╛ржзрж╛ржи ржмрзНржпржмрж╣рж╛рж░](../..)
7. [ржЙржирзНржиржд ржмрзИрж╢рж┐рж╖рзНржЯрзНржп](../..)
8. [рж╕ржорж╕рзНржпрж╛ рж╕ржорж╛ржзрж╛ржи](../..)
9. [рж╕рзЗрж░рж╛ ржЕржирзБрж╢рзАрж▓ржи](../..)

## ржкрж░рзНржпрж╛рж▓рзЛржЪржирж╛

ржПржЗ ржирж┐рж░рзНржжрзЗрж╢рж┐ржХрж╛ ржжрзЗржЦрж╛ржпрж╝ ржХрзАржнрж╛ржмрзЗ ржПржХржЯрж┐ ржкрзНрж░рзЛржбрж╛ржХрж╢ржи-рж░рзЗржбрж┐ **Model Context Protocol (MCP) рж╕рж╛рж░рзНржнрж╛рж░** рждрзИрж░рж┐ ржПржмржВ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рждрзЗ рж╣ржпрж╝, ржпрж╛ PostgreSQL ржПржмржВ Azure AI ржкрж░рж┐рж╖рзЗржмрж╛рж░ рж╕рж╛ржерзЗ рж╕ржВржпрзБржХрзНрждред ржПржЗ ржиржорзБржирж╛ ржПржирзНржЯрж╛рж░ржкрзНрж░рж╛ржЗржЬ-ржЧрзНрж░рзЗржб ржкрзНржпрж╛ржЯрж╛рж░рзНржи ржпрзЗржоржи Row Level Security, рж╕рзЗржорж╛ржирзНржЯрж┐ржХ рж╕рж╛рж░рзНржЪ ржПржмржВ ржорж╛рж▓рзНржЯрж┐-ржЯрзЗржирзНржпрж╛ржирзНржЯ ржбрзЗржЯрж╛ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржкрзНрж░ржжрж░рзНрж╢ржи ржХрж░рзЗред

### ржЖржкржирж┐ ржпрж╛ рж╢рж┐ржЦржмрзЗржи
- MCP рж╕рж╛рж░рзНржнрж╛рж░ рж╕рзНржерж╛ржкрждрзНржп ржПржмржВ ржбрзЗржЯрж╛ржмрзЗрж╕ ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи
- ржорж╛рж▓рзНржЯрж┐-ржЯрзЗржирзНржпрж╛ржирзНржЯ ржкрж░рж┐рж╕рзНржерж┐рждрж┐рж░ ржЬржирзНржп Row Level Security ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржи
- Azure OpenAI embeddings ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ рж╕рзЗржорж╛ржирзНржЯрж┐ржХ рж╕рж╛рж░рзНржЪ рждрзИрж░рж┐ ржХрж░рж╛
- Docker-ржнрж┐рждрзНрждрж┐ржХ ржбрзЗржнрзЗрж▓ржкржорзЗржирзНржЯ ржкрж░рж┐ржмрзЗрж╢ рждрзИрж░рж┐ ржХрж░рж╛
- Bicep ржЯрзЗржоржкрзНрж▓рзЗржЯ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ Azure ржЕржмржХрж╛ржарж╛ржорзЛ ржорзЛрждрж╛ржпрж╝рзЗржи
- AI-ржЪрж╛рж▓рж┐ржд ржмрж┐рж╢рзНрж▓рзЗрж╖ржгрзЗрж░ ржЬржирзНржп VS Code ржПрж░ рж╕рж╛ржерзЗ ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи

### ржмрзНржпржмрж╣рзГржд ржкрзНрж░ржпрзБржХрзНрждрж┐
- **MCP Protocol**: AI ржЯрзБрж▓ ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржирзЗрж░ ржЬржирзНржп Model Context Protocol
- **FastMCP**: ржЖржзрзБржирж┐ржХ Python MCP рж╕рж╛рж░рзНржнрж╛рж░ ржлрзНрж░рзЗржоржУржпрж╝рж╛рж░рзНржХ
- **PostgreSQL**: pgvector ржПржХрзНрж╕ржЯрзЗржирж╢ржи рж╕рж╣ ржбрзЗржЯрж╛ржмрзЗрж╕ рж╕рзЗржорж╛ржирзНржЯрж┐ржХ рж╕рж╛рж░рзНржЪрзЗрж░ ржЬржирзНржп
- **Azure OpenAI**: ржЯрзЗржХрзНрж╕ржЯ embeddings ржПржмржВ ржРржЪрзНржЫрж┐ржХ GPT ржоржбрзЗрж▓
- **Docker**: ржзрж╛рж░рж╛ржмрж╛рж╣рж┐ржХ ржкрж░рж┐ржмрзЗрж╢рзЗрж░ ржЬржирзНржп ржХржирзНржЯрзЗржЗржирж╛рж░рж╛ржЗржЬрзЗрж╢ржи
- **Bicep**: Azure рж░рж┐рж╕рзЛрж░рзНрж╕рзЗрж░ ржЬржирзНржп Infrastructure as Code
- **VS Code**: MCP ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржирзЗрж░ рж╕рж╛ржерзЗ ржбрзЗржнрзЗрж▓ржкржорзЗржирзНржЯ ржкрж░рж┐ржмрзЗрж╢

## ЁЯУЪ ржХрж╛ржарж╛ржорзЛржЧржд рж╢рж┐ржХрзНрж╖рж╛рж░ ржирж┐рж░рзНржжрзЗрж╢рж┐ржХрж╛: /walkthrough

ржПржЗ ржкрзНрж░ржпрзБржХрзНрждрж┐ржЧржд ржирж┐рж░рзНржжрзЗрж╢рж┐ржХрж╛рж░ ржкрж╛рж╢рж╛ржкрж╛рж╢рж┐, ржПржЗ рж░рж┐ржкрзЛржЬрж┐ржЯрж░рж┐рждрзЗ ржПржХржЯрж┐ ржмрж┐рж╕рзНрждрзГржд **рззрзи-ржоржбрж┐ржЙрж▓ рж╢рж┐ржХрзНрж╖рж╛рж░ ржирж┐рж░рзНржжрзЗрж╢рж┐ржХрж╛** ржЕржирзНрждрж░рзНржнрзБржХрзНржд рж░ржпрж╝рзЗржЫрзЗ ржпрж╛ `/walkthrough` ржбрж┐рж░рзЗржХрзНржЯрж░рж┐рждрзЗ ржЕржмрж╕рзНржерж┐рждред ржПржЗ ржХрж╛ржарж╛ржорзЛржЧржд ржкржжрзНржзрждрж┐ ржЬржЯрж┐рж▓ ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржиржХрзЗ рж╕рж╣ржЬрзЗ ржмрзЛржЭрж╛рж░ ржЬржирзНржп ржкрж░рзНржпрж╛ржпрж╝ржХрзНрж░ржорзЗ ржнрзЗржЩрзЗ ржжрзЗржпрж╝, ржпрж╛ ржбрзЗржнрзЗрж▓ржкрж╛рж░ржжрзЗрж░ ржкрзНрж░рждрж┐ржЯрж┐ ржЙржкрж╛ржжрж╛ржи ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ ржмрзБржЭрждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рзЗред

### рж╢рж┐ржХрзНрж╖рж╛рж░ ржоржбрж┐ржЙрж▓ ржкрж░рзНржпрж╛рж▓рзЛржЪржирж╛

| ржоржбрж┐ржЙрж▓ | ржмрж┐рж╖ржпрж╝ | ржлрзЛржХрж╛рж╕ | рж╕ржоржпрж╝ржХрж╛рж▓ |
|--------|-------|-------|----------|
| **[00-Introduction](walkthrough/00-Introduction/README.md)** | MCP ржорзМрж▓рж┐ржХ ржмрж┐рж╖ржпрж╝ | ржорзВрж▓ ржзрж╛рж░ржгрж╛, Zava Retail ржХрзЗрж╕ рж╕рзНржЯрж╛ржбрж┐, рж╕рзНржерж╛ржкрждрзНржп ржкрж░рзНржпрж╛рж▓рзЛржЪржирж╛ | рзйрзж ржорж┐ржирж┐ржЯ |
| **[01-Architecture](walkthrough/01-Architecture/README.md)** | рж╕рж┐рж╕рзНржЯрзЗржо ржбрж┐ржЬрж╛ржЗржи | ржкрзНрж░ржпрзБржХрзНрждрж┐ржЧржд рж╕рзНржерж╛ржкрждрзНржп, ржбрж┐ржЬрж╛ржЗржи ржкрзНржпрж╛ржЯрж╛рж░рзНржи, ржЙржкрж╛ржжрж╛ржи рж╕ржорзНржкрж░рзНржХ | рзкрзл ржорж┐ржирж┐ржЯ |
| **[02-Security](walkthrough/02-Security/README.md)** | ржПржирзНржЯрж╛рж░ржкрзНрж░рж╛ржЗржЬ ржирж┐рж░рж╛ржкрждрзНрждрж╛ | Azure ржкрзНрж░ржорж╛ржгрзАржХрж░ржг, Row Level Security, ржорж╛рж▓рзНржЯрж┐-ржЯрзЗржирзНржпрж╛ржирзНржЯ ржмрж┐ржЪрзНржЫрж┐ржирзНржирждрж╛ | рзмрзж ржорж┐ржирж┐ржЯ |
| **[03-Setup](walkthrough/03-Setup/README.md)** | ржкрж░рж┐ржмрзЗрж╢ рж╕рзЗржЯржЖржк | Docker ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи, Azure CLI, ржкрзНрж░ржХрж▓рзНржк ржкрзНрж░рж╛рж░ржорзНржн | рзкрзл ржорж┐ржирж┐ржЯ |
| **[04-Database](walkthrough/04-Database/README.md)** | ржбрзЗржЯрж╛ рж╕рзНрждрж░ | PostgreSQL рж╕рзНржХрж┐ржорж╛, pgvector рж╕рзЗржЯржЖржк, RLS ржирзАрждрж┐ржорж╛рж▓рж╛, ржиржорзБржирж╛ ржбрзЗржЯрж╛ | рзмрзж ржорж┐ржирж┐ржЯ |
| **[05-MCP-Server](walkthrough/05-MCP-Server/README.md)** | ржорзВрж▓ ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржи | FastMCP ржлрзНрж░рзЗржоржУржпрж╝рж╛рж░рзНржХ, ржбрзЗржЯрж╛ржмрзЗрж╕ ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи, ржЯрзБрж▓ ржбрзЗржнрзЗрж▓ржкржорзЗржирзНржЯ | рзпрзж ржорж┐ржирж┐ржЯ |
| **[06-Tools](walkthrough/06-Tools/README.md)** | ржЯрзБрж▓ ржбрзЗржнрзЗрж▓ржкржорзЗржирзНржЯ | MCP ржЯрзБрж▓ рждрзИрж░рж┐, ржХрзЛржпрж╝рзЗрж░рж┐ ржпрж╛ржЪрж╛ржЗржХрж░ржг, ржмрзНржпржмрж╕рж╛ржпрж╝рж┐ржХ ржмрзБржжрзНржзрж┐ржорждрзНрждрж╛ | рзнрзл ржорж┐ржирж┐ржЯ |
| **[07-Semantic-Search](walkthrough/07-Semantic-Search/README.md)** | AI ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи | Azure OpenAI embeddings, ржнрзЗржХрзНржЯрж░ рж╕рж╛рж░рзНржЪ, рж╣рж╛ржЗржмрзНрж░рж┐ржб ржХрзЛржпрж╝рзЗрж░рж┐ | рзмрзж ржорж┐ржирж┐ржЯ |
| **[08-Testing](walkthrough/08-Testing/README.md)** | ржЧрзБржгржорж╛ржи ржирж┐рж╢рзНржЪрж┐рждржХрж░ржг | ржЯрзЗрж╕рзНржЯрж┐ржВ ржХрзМрж╢рж▓, ржбрж┐ржмрж╛ржЧрж┐ржВ ржХрзМрж╢рж▓, ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржЯрзЗрж╕рзНржЯрж┐ржВ | рзнрзл ржорж┐ржирж┐ржЯ |
| **[09-VS-Code](walkthrough/09-VS-Code/README.md)** | ржбрзЗржнрзЗрж▓ржкржорзЗржирзНржЯ ржЕржнрж┐ржЬрзНржЮрждрж╛ | VS Code ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи, AI ржЪрзНржпрж╛ржЯ ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи, ржбрж┐ржмрж╛ржЧрж┐ржВ ржУржпрж╝рж╛рж░рзНржХржлрзНрж▓рзЛ | рзкрзл ржорж┐ржирж┐ржЯ |
| **[10-Deployment](walkthrough/10-Deployment/README.md)** | ржкрзНрж░рзЛржбрж╛ржХрж╢ржи ржорзЛрждрж╛ржпрж╝рзЗржи | ржХржирзНржЯрзЗржЗржирж╛рж░рж╛ржЗржЬрзЗрж╢ржи, Azure Container Apps, CI/CD ржкрж╛ржЗржкрж▓рж╛ржЗржи | рзпрзж ржорж┐ржирж┐ржЯ |
| **[11-Monitoring](walkthrough/11-Monitoring/README.md)** | ржкрж░рзНржпржмрзЗржХрзНрж╖ржгржпрзЛржЧрзНржпрждрж╛ | Application Insights, ржХрж╛ржарж╛ржорзЛржЧржд рж▓ржЧрж┐ржВ, ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржорзЗржЯрзНрж░рж┐ржХ | рзмрзж ржорж┐ржирж┐ржЯ |
| **[12-Best-Practices](walkthrough/12-Best-Practices/README.md)** | ржкрзНрж░рзЛржбрж╛ржХрж╢ржи ржЙрзОржХрж░рзНрж╖рждрж╛ | ржирж┐рж░рж╛ржкрждрзНрждрж╛ рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзАржХрж░ржг, ржЕржкрзНржЯрж┐ржорж╛ржЗржЬрзЗрж╢ржи, ржПржирзНржЯрж╛рж░ржкрзНрж░рж╛ржЗржЬ ржкрзНржпрж╛ржЯрж╛рж░рзНржи | рзкрзл ржорж┐ржирж┐ржЯ |

### рж╢рж┐ржХрзНрж╖рж╛рж░ ржирж┐рж░рзНржжрзЗрж╢рж┐ржХрж╛ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛рж░ ржкржжрзНржзрждрж┐

**ЁЯУЦ рж╢рзЗржЦрж╛рж░ ржЬржирзНржп**: `/walkthrough` ржоржбрж┐ржЙрж▓ржЧрзБрж▓рж┐ ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ ржирж┐рж░рзНржжрзЗрж╢ржирж╛ ржкрзНрж░ржжрж╛ржи ржХрж░рзЗ ржПржмржВ ржкрзНрж░рждрж┐ржЯрж┐ ржЙржкрж╛ржжрж╛ржи ржХрзЗржи ржПржЗржнрж╛ржмрзЗ ржбрж┐ржЬрж╛ржЗржи ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ рждрж╛рж░ ржмрзНржпрж╛ржЦрзНржпрж╛ ржжрзЗржпрж╝ред ржоржбрж┐ржЙрж▓ рзжрзж ржжрж┐ржпрж╝рзЗ рж╢рзБрж░рзБ ржХрж░рзБржи ржПржмржВ ржХрзНрж░ржорж╛ржирзНржмржпрж╝рзЗ ржПржЧрж┐ржпрж╝рзЗ ржпрж╛ржиред

**ЁЯФз ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржирзЗрж░ ржЬржирзНржп**: ржПржЗ Sample_Walkthrough.md ржжрзНрж░рзБржд рж╕ржорзНржкрзВрж░рзНржг ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржи ржмрзБржЭрждрзЗ ржЪрж╛ржУржпрж╝рж╛ ржбрзЗржнрзЗрж▓ржкрж╛рж░ржжрзЗрж░ ржЬржирзНржп ржкрзНрж░ржпрзБржХрзНрждрж┐ржЧржд ржмрж┐рж╢рзНрж▓рзЗрж╖ржг ржПржмржВ ржХрзЛржб ржмрзНрж░рзЗржХржбрж╛ржЙржи ржкрзНрж░ржжрж╛ржи ржХрж░рзЗред

**ЁЯЪА ржкрзНрж░рзЛржбрж╛ржХрж╢ржирзЗрж░ ржЬржирзНржп**: ржоржбрж┐ржЙрж▓ рзжрзи, рззрзж, рззрзз, ржПржмржВ рззрзи ржмрж┐рж╢рзЗрж╖ржнрж╛ржмрзЗ ржкрзНрж░рзЛржбрж╛ржХрж╢ржи-рж░рзЗржбрж┐ ржорзЛрждрж╛ржпрж╝рзЗржи, ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржПржмржВ ржкрж░рзНржпржмрзЗржХрзНрж╖ржг ржмрж┐ржмрзЗржЪржирж╛рж░ ржЙржкрж░ ржлрзЛржХрж╛рж╕ ржХрж░рзЗред

**ЁЯУЪ рж╕ржорзНржкрзВрж░рзНржг рж╢рж┐ржХрзНрж╖рж╛рж░ ржкрже**: ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд рж╢рж┐ржХрзНрж╖рж╛рж░ ржЙржжрзНржжрзЗрж╢рзНржп ржПржмржВ ржкрзВрж░рзНржмрж╢рж░рзНржд рж╕рж╣ рж╕ржорзНржкрзВрж░рзНржг рж╢рж┐ржХрзНрж╖рж╛рж░ ржирж┐рж░рзНржжрзЗрж╢рж┐ржХрж╛ ржкрж░рзНржпрж╛рж▓рзЛржЪржирж╛рж░ ржЬржирзНржп **[/walkthrough/README.md](walkthrough/README.md)** ржжрзЗржЦрзБржиред

---

## рж╕рзНржерж╛ржкрждрзНржп ржмрж┐рж╢рзНрж▓рзЗрж╖ржг

### ржЙржЪрзНржЪ-рж╕рзНрждрж░рзЗрж░ рж╕рзНржерж╛ржкрждрзНржп

```
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР    тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР    тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ   VS Code AI    тФВ    тФВ   MCP Server    тФВ    тФВ   PostgreSQL    тФВ
тФВ     Client      тФВтЧДтФАтФАтЦ║тФВ  (FastMCP)      тФВтЧДтФАтФАтЦ║тФВ   + pgvector    тФВ
тФВ                 тФВ    тФВ                 тФВ    тФВ                 тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ    тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ    тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
                                тФВ
                                тЦ╝
                       тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
                       тФВ  Azure OpenAI   тФВ
                       тФВ   Embeddings    тФВ
                       тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

### ржорзВрж▓ ржЙржкрж╛ржжрж╛ржирж╕ржорзВрж╣

#### рзз. **MCP рж╕рж╛рж░рзНржнрж╛рж░ (`sales_analysis.py`)**
- **FastMCP Framework**: HTTP/SSE ржкрзНрж░рзЛржЯрзЛржХрж▓ ржпрзЛржЧрж╛ржпрзЛржЧ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзЗ
- **ржЯрзБрж▓ ржирж┐ржмржирзНржзржи**: ржбрзЗржЯрж╛ржмрзЗрж╕ ржХрзЛржпрж╝рзЗрж░рж┐ ржПржмржВ рж╕рзНржХрж┐ржорж╛ ржЯрзБрж▓ ржкрзНрж░ржХрж╛рж╢ ржХрж░рзЗ
- **ржЕржирзБрж░рзЛржз ржкрзНрж░рж╕ржЩрзНржЧ**: RLS ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА рж╢ржирж╛ржХрзНрждржХрж░ржг ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзЗ
- **рждрзНрж░рзБржЯрж┐ ржкрж░рж┐ржЪрж╛рж▓ржирж╛**: рж╢ржХрзНрждрж┐рж╢рж╛рж▓рзА рждрзНрж░рзБржЯрж┐ ржмрзНржпржмрж╕рзНржерж╛ржкржирж╛ ржПржмржВ рж▓ржЧрж┐ржВ

#### рзи. **ржбрзЗржЯрж╛ржмрзЗрж╕ рж╕рзНрждрж░ (`sales_analysis_postgres.py`)**
- **рж╕ржВржпрзЛржЧ ржкрзБрж▓рж┐ржВ**: ржжржХрзНрж╖ asyncpg рж╕ржВржпрзЛржЧ ржмрзНржпржмрж╕рзНржерж╛ржкржирж╛
- **рж╕рзНржХрж┐ржорж╛ ржкрзНрж░ржжрж╛ржиржХрж╛рж░рзА**: ржЧрждрж┐рж╢рзАрж▓ ржЯрзЗржмрж┐рж▓ рж╕рзНржХрж┐ржорж╛ ржЖржмрж┐рж╖рзНржХрж╛рж░
- **ржХрзЛржпрж╝рзЗрж░рж┐ ржХрж╛рж░рзНржпржХрж░ржХрж░ржг**: RLS рж╕рж╣ ржирж┐рж░рж╛ржкржж SQL ржХрж╛рж░рзНржпржХрж░ржХрж░ржг
- **рж╕рзЗржорж╛ржирзНржЯрж┐ржХ рж╕рж╛рж░рзНржЪ**: pgvector рж╕рж╣ ржнрзЗржХрзНржЯрж░ рж╕рж╛ржжрзГрж╢рзНржп ржЕржирзБрж╕ржирзНржзрж╛ржи

#### рзй. **ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржмрзНржпржмрж╕рзНржерж╛ржкржирж╛ (`config.py`)**
- **ржкрж░рж┐ржмрзЗрж╢ ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓**: ржХрзЗржирзНржжрзНрж░рзАржпрж╝ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржкрж░рж┐ржЪрж╛рж▓ржирж╛
- **рж╕ржВржпрзЛржЧ ржкрзНржпрж╛рж░рж╛ржорж┐ржЯрж╛рж░**: ржбрзЗржЯрж╛ржмрзЗрж╕ ржПржмржВ Azure ржкрж░рж┐рж╖рзЗржмрж╛ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи
- **ржпрж╛ржЪрж╛ржЗржХрж░ржг**: ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржкрж░рж┐ржмрзЗрж╢ ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓ ржпрж╛ржЪрж╛ржЗржХрж░ржг

#### рзк. **ржЕржмржХрж╛ржарж╛ржорзЛ (`infra/`)**
- **Bicep ржЯрзЗржоржкрзНрж▓рзЗржЯ**: ржШрзЛрж╖ржгрж╛ржорзВрж▓ржХ Azure рж░рж┐рж╕рзЛрж░рзНрж╕ ржкрзНрж░ржнрж┐рж╢ржирж┐ржВ
- **ржоржбрзЗрж▓ ржорзЛрждрж╛ржпрж╝рзЗржи**: рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ AI ржоржбрзЗрж▓ ржорзЛрждрж╛ржпрж╝рзЗржи
- **рж░рзЛрж▓ ржЕрзНржпрж╛рж╕рж╛ржЗржиржорзЗржирзНржЯ**: ржирж┐рж░рж╛ржкрждрзНрждрж╛ рж░рзЛрж▓ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи

### ржбрзЗржЯрж╛ ржкрзНрж░ржмрж╛рж╣

```
1. VS Code AI Client sends query
2. MCP Server receives request with RLS headers
3. Server extracts user identity and sets context
4. Database queries execute with RLS filtering
5. Results return through MCP protocol
6. AI Client processes structured response
```

---

## рж╕ржорж╛ржзрж╛ржи рждрзИрж░рж┐

### ржзрж╛ржк рзз: ржкрзНрж░ржХрж▓рзНржк ржХрж╛ржарж╛ржорзЛ рж╕рзЗржЯржЖржк

```
project/
тФЬтФАтФА mcp_server/              # MCP server implementation
тФВ   тФЬтФАтФА __init__.py         # Package initialization
тФВ   тФЬтФАтФА sales_analysis.py   # Main MCP server
тФВ   тФЬтФАтФА sales_analysis_postgres.py  # Database layer
тФВ   тФЬтФАтФА sales_analysis_text_embeddings.py  # Semantic search
тФВ   тФФтФАтФА config.py           # Configuration management
тФЬтФАтФА infra/                  # Infrastructure as Code
тФВ   тФЬтФАтФА main.bicep          # Main deployment template
тФВ   тФЬтФАтФА foundry.bicep       # Azure AI Foundry setup
тФВ   тФЬтФАтФА deploy.ps1          # Windows deployment script
тФВ   тФФтФАтФА deploy.sh           # Unix deployment script
тФЬтФАтФА data/                   # Database backup and initialization
тФЬтФАтФА docker-init/            # Database initialization scripts
тФЬтФАтФА .vscode/                # VS Code MCP configuration
тФЬтФАтФА docker-compose.yml      # Development environment
тФЬтФАтФА Dockerfile             # MCP server container
тФФтФАтФА requirements.lock.txt   # Python dependencies
```

### ржзрж╛ржк рзи: ржорзВрж▓ ржирж┐рж░рзНржнрж░рждрж╛

**Python Requirements:**
```python
# MCP Framework
mcp[server]>=0.5.0
fastmcp>=0.4.0

# Database Integration
asyncpg>=0.29.0
asyncio-rlock>=0.3.0

# Azure Integration
azure-ai-projects>=1.0.0
azure-identity>=1.19.0
azure-monitor-opentelemetry>=1.7.0

# Data Processing
pydantic>=2.9.0
numpy>=1.24.0

# Development
python-dotenv>=1.0.0
```

**рж╕рж┐рж╕рзНржЯрзЗржорзЗрж░ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝рждрж╛:**
- ржХржирзНржЯрзЗржЗржирж╛рж░рж╛ржЗржЬрзЗрж╢ржирзЗрж░ ржЬржирзНржп Docker Desktop
- ржорзЛрждрж╛ржпрж╝рзЗржирзЗрж░ ржЬржирзНржп Azure CLI
- pgvector ржПржХрзНрж╕ржЯрзЗржирж╢ржи рж╕рж╣ PostgreSQL
- AI ржПржХрзНрж╕ржЯрзЗржирж╢ржи рж╕рж╣ VS Code

### ржзрж╛ржк рзй: ржбрзЗржЯрж╛ржмрзЗрж╕ рж╕рзНржХрж┐ржорж╛ ржбрж┐ржЬрж╛ржЗржи

ржиржорзБржирж╛ржЯрж┐ ржПржХржЯрж┐ рж░рж┐ржЯрзЗржЗрж▓ ржбрзЗржЯрж╛ржмрзЗрж╕ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржпрж╛рж░ ржорзВрж▓ ржЯрзЗржмрж┐рж▓ржЧрзБрж▓рж┐ ржирж┐ржорзНржирж░рзВржк:

```sql
-- Core business entities
retail.stores          -- Store locations and metadata
retail.customers       -- Customer profiles
retail.categories      -- Product categorization
retail.product_types   -- Product type definitions
retail.products        -- Product catalog
retail.orders          -- Customer orders
retail.order_items     -- Order line items
retail.inventory       -- Stock levels

-- Semantic search support
retail.product_description_embeddings  -- Vector embeddings for products
```

**Row Level Security (RLS) ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржи:**
```sql
-- Enable RLS on tables
ALTER TABLE retail.orders ENABLE ROW LEVEL SECURITY;
ALTER TABLE retail.customers ENABLE ROW LEVEL SECURITY;

-- Create policies based on store association
CREATE POLICY store_policy ON retail.orders
  FOR ALL TO PUBLIC
  USING (store_id = get_user_store_id());
```

---

## ржЙржкрж╛ржжрж╛ржи ржмрж┐рж╢рзНрж▓рзЗрж╖ржг

### MCP рж╕рж╛рж░рзНржнрж╛рж░ ржХрзЛрж░ (`sales_analysis.py`)

#### ржЯрзБрж▓ ржирж┐ржмржирзНржзржи ржкрзНржпрж╛ржЯрж╛рж░рзНржи
```python
@mcp.tool()
async def execute_sales_query(
    ctx: Context,
    postgresql_query: Annotated[str, Field(description="A well-formed PostgreSQL query.")],
) -> str:
    """Execute PostgreSQL queries with Row Level Security."""
    rls_user_id = get_rls_user_id(ctx)
    
    try:
        return await db_provider.execute_query(
            postgresql_query, rls_user_id=rls_user_id
        )
    except Exception as e:
        logger.error("Error executing database query: %s", e)
        return f"Error executing database query: {e!s}"
```

**ржорзВрж▓ ржмрзИрж╢рж┐рж╖рзНржЯрзНржп:**
- **ржЯрж╛ржЗржк ржЕрзНржпрж╛ржирзЛржЯрзЗрж╢ржи**: AI ржмрзЛржЭрж╛рж░ ржЬржирзНржп Pydantic ржХрзНрж╖рзЗрждрзНрж░рзЗрж░ ржмрж┐ржмрж░ржг
- **ржкрзНрж░рж╕ржЩрзНржЧ ржирж┐рж╖рзНржХрж╛рж╢ржи**: HTTP рж╣рзЗржбрж╛рж░ ржерзЗржХрзЗ ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА ржкрж░рж┐ржЪржпрж╝
- **рждрзНрж░рзБржЯрж┐ ржкрж░рж┐ржЪрж╛рж▓ржирж╛**: рждржерзНржпржкрзВрж░рзНржг ржмрж╛рж░рзНрждрж╛рж╕рж╣ ржЧрзНрж░рзЗрж╕ржлрзБрж▓ ржмрзНржпрж░рзНржерждрж╛
- **рж▓ржЧрж┐ржВ**: ржмрзНржпрж╛ржкржХ ржЕржкрж╛рж░рзЗрж╢ржи рж▓ржЧрж┐ржВ

#### ржЕржирзБрж░рзЛржз ржкрзНрж░рж╕ржЩрзНржЧ ржмрзНржпржмрж╕рзНржерж╛ржкржирж╛
```python
def get_rls_user_id(ctx: Context) -> str:
    """Extract Row Level Security User ID from request context."""
    rls_user_id = get_header(ctx, "x-rls-user-id")
    if rls_user_id is None:
        # Default to placeholder if not provided
        rls_user_id = "00000000-0000-0000-0000-000000000000"
    return rls_user_id
```

### ржбрзЗржЯрж╛ржмрзЗрж╕ рж╕рзНрждрж░ (`sales_analysis_postgres.py`)

#### рж╕ржВржпрзЛржЧ ржкрзБрж▓ ржмрзНржпржмрж╕рзНржерж╛ржкржирж╛
```python
class PostgreSQLSchemaProvider:
    async def create_pool(self) -> None:
        """Create connection pool for better resource management."""
        if self.connection_pool is None:
            config_copy = dict(self.postgres_config)
            existing_server_settings = config_copy.pop("server_settings", {})
            
            merged_server_settings = {
                **existing_server_settings,
                "jit": "off",  # Disable JIT to reduce memory usage
                "work_mem": "4MB",  # Limit work memory per query
                "statement_timeout": "30s",  # 30 second statement timeout
            }
            
            self.connection_pool = await asyncpg.create_pool(
                **config_copy,
                min_size=1,
                max_size=3,  # Conservative pool size
                command_timeout=30,
                server_settings=merged_server_settings,
            )
```

**ржбрж┐ржЬрж╛ржЗржи ржкрзНржпрж╛ржЯрж╛рж░рзНржи:**
- **рж░рж┐рж╕рзЛрж░рзНрж╕ ржмрзНржпржмрж╕рзНржерж╛ржкржирж╛**: рж╕ржарж┐ржХ ржкрзБрж▓ рж▓рж╛ржЗржлрж╕рж╛ржЗржХрзЗрж▓ ржмрзНржпржмрж╕рзНржерж╛ржкржирж╛
- **ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржЯрж┐ржЙржирж┐ржВ**: ржЕржкрзНржЯрж┐ржорж╛ржЗржЬржб PostgreSQL рж╕рзЗржЯрж┐ржВрж╕
- **рждрзНрж░рзБржЯрж┐ ржкрзБржирж░рзБржжрзНржзрж╛рж░**: рж╕ржВржпрзЛржЧ ржкрзБржирж░рж╛ржпрж╝ ржЪрзЗрж╖рзНржЯрж╛ ржПржмржВ ржмрзНржпрж╛ржХржЖржк рж▓ржЬрж┐ржХ
- **ржирж┐рж░рж╛ржкрждрзНрждрж╛**: ржкрзНрж░рждрж┐ рж╕ржВржпрзЛржЧрзЗ RLS ржкрзНрж░рж╕ржЩрзНржЧ рж╕рзЗржЯрж┐ржВ

#### рж╕рзНржХрж┐ржорж╛ ржЕржирзНрждрж░рзНржжрзГрж╖рзНржЯрж┐
```python
async def get_table_schema(self, table_name: str, rls_user_id: str) -> Dict[str, Any]:
    """Return comprehensive schema information for a table."""
    conn = await self.get_connection()
    
    # Set RLS context
    await conn.execute(
        "SELECT set_config('app.current_rls_user_id', $1, false)", 
        rls_user_id
    )
    
    # Get column information
    columns = await conn.fetch("""
        SELECT column_name, data_type, is_nullable, column_default
        FROM information_schema.columns 
        WHERE table_schema = $1 AND table_name = $2
        ORDER BY ordinal_position
    """, schema_name, table_name)
    
    # Get foreign key relationships
    foreign_keys = await conn.fetch("""
        SELECT kcu.column_name, ccu.table_name AS foreign_table_name
        FROM information_schema.table_constraints tc
        JOIN information_schema.key_column_usage kcu ON ...
    """)
```

### рж╕рзЗржорж╛ржирзНржЯрж┐ржХ рж╕рж╛рж░рзНржЪ ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи

#### ржПржоржмрзЗржбрж┐ржВ ржЬрзЗржирж╛рж░рзЗрж╢ржи
```python
class SemanticSearchTextEmbedding:
    def generate_query_embedding(self, query: str) -> Optional[List[float]]:
        """Generate embeddings using Azure OpenAI."""
        try:
            response = self.client.embeddings.create(
                input=[query],
                model=self.deployment_name
            )
            return response.data[0].embedding
        except Exception as e:
            logger.error("Embedding generation failed: %s", e)
            return None
```

#### ржнрзЗржХрзНржЯрж░ рж╕рж╛ржжрзГрж╢рзНржп ржЕржирзБрж╕ржирзНржзрж╛ржи
```python
async def search_products_by_similarity(
    self,
    query_embedding: List[float],
    rls_user_id: str,
    max_rows: int = 20,
    similarity_threshold: float = 30.0,
) -> str:
    """Search products using pgvector cosine similarity."""
    
    # Convert similarity percentage to distance threshold
    distance_threshold = 1.0 - (similarity_threshold / 100.0)
    
    query = f"""
        SELECT p.*, (pde.description_embedding <=> $1::vector) as distance
        FROM {SCHEMA_NAME}.product_description_embeddings pde
        JOIN {SCHEMA_NAME}.products p ON pde.product_id = p.product_id
        WHERE (pde.description_embedding <=> $1::vector) <= $3
        ORDER BY distance
        LIMIT $2
    """
    
    rows = await conn.fetch(query, embedding_str, max_rows, distance_threshold)
```

---

## ржорзЛрждрж╛ржпрж╝рзЗржи ржирж┐рж░рзНржжрзЗрж╢рж┐ржХрж╛

### Azure ржЕржмржХрж╛ржарж╛ржорзЛ ржорзЛрждрж╛ржпрж╝рзЗржи

#### рзз. **Bicep ржЯрзЗржоржкрзНрж▓рзЗржЯ ржХрж╛ржарж╛ржорзЛ**

**ржорзВрж▓ ржЯрзЗржоржкрзНрж▓рзЗржЯ (`main.bicep`):**
```bicep
targetScope = 'subscription'

// Core parameters
param resourcePrefix string
param location string
param models array = [
  {
    name: 'text-embedding-3-small'
    format: 'OpenAI'
    version: '1'
    capacity: 50
  }
]

// Deploy foundry and project resources
module foundry 'foundry.bicep' = {
  name: 'foundry-account-deployment'
  scope: rg
  params: {
    foundryResourceName: foundryResourceName
    location: location
  }
}

module foundryProject 'foundry-project.bicep' = {
  name: 'foundry-project-deployment'
  scope: rg
  dependsOn: [foundry]
  params: {
    foundryResourceName: foundry.outputs.accountName
    aiProjectName: aiProjectName
  }
}
```

#### рзи. **ржорзЛрждрж╛ржпрж╝рзЗржи рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝рждрж╛**

**PowerShell ржорзЛрждрж╛ржпрж╝рзЗржи (`deploy.ps1`):**
```powershell
# Generate unique suffix for resources
$UNIQUE_SUFFIX = -join ((97..122) + (48..57) | Get-Random -Count 4 | ForEach-Object { [char]$_ })

# Deploy Azure resources
az deployment sub create `
  --name "$DEPLOYMENT_NAME" `
  --location "$RG_LOCATION" `
  --template-file main.bicep `
  --parameters location="$RG_LOCATION" `
  --parameters resourcePrefix="$RESOURCE_PREFIX" `
  --parameters uniqueSuffix="$UNIQUE_SUFFIX" `
  --parameters models="$modelsJson"

# Create service principal for authentication
$spResult = az ad sp create-for-rbac `
    --name "zava-mcp-server-sp" `
    --role "Cognitive Services OpenAI User" `
    --scopes "/subscriptions/$SubId/resourceGroups/$RESOURCE_GROUP_NAME"

# Generate .env file with configuration
@"
PROJECT_ENDPOINT=$PROJECTS_ENDPOINT
AZURE_OPENAI_ENDPOINT=$AZURE_OPENAI_ENDPOINT
EMBEDDING_MODEL_DEPLOYMENT_NAME="text-embedding-3-small"
AZURE_CLIENT_ID=$clientId
AZURE_CLIENT_SECRET=$clientSecret
AZURE_TENANT_ID=$tenantId
"@ | Out-File -FilePath "../.env"
```

### рж╕рзНржерж╛ржирзАржпрж╝ ржбрзЗржнрзЗрж▓ржкржорзЗржирзНржЯ рж╕рзЗржЯржЖржк

#### рзз. **Docker Compose ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи**
```yaml
# docker-compose.yml
version: '3.8'
services:
  postgres:
    image: pgvector/pgvector:pg17
    environment:
      - POSTGRES_INITDB_ARGS=--auth-host=scram-sha-256
    volumes:
      - ./data:/backup_data:ro
      - ./docker-init:/docker-entrypoint-initdb.d:ro
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres -d zava"]
      interval: 15s
      retries: 5

  mcp_server:
    build: .
    depends_on:
      postgres:
        condition: service_healthy
    ports:
      - "8000:8000"
    env_file:
      - .env
```

#### рзи. **ржбрзЗржЯрж╛ржмрзЗрж╕ ржкрзНрж░рж╛рж░ржорзНржнрж┐ржХржХрж░ржг**
```bash
# docker-init/init-db.sh
#!/bin/bash
set -e

# Create extensions
psql -v ON_ERROR_STOP=1 --username "$POSTGRES_USER" --dbname "$POSTGRES_DB" <<-EOSQL
    CREATE EXTENSION IF NOT EXISTS vector;
    CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
EOSQL

# Restore database backup
if [ -f /backup_data/zava_retail_2025_07_21_postgres_rls.backup ]; then
    pg_restore --username "$POSTGRES_USER" --dbname "$POSTGRES_DB" \
               --verbose --clean --no-acl --no-owner \
               /backup_data/zava_retail_2025_07_21_postgres_rls.backup
fi
```

---

## рж╕ржорж╛ржзрж╛ржи ржмрзНржпржмрж╣рж╛рж░

### VS Code ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи

#### рзз. **MCP ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи (`.vscode/mcp.json`)**
```json
{
    "servers": {
        "zava-sales-analysis-headoffice": {
            "url": "http://127.0.0.1:8000/mcp",
            "type": "http",
            "headers": {"x-rls-user-id": "00000000-0000-0000-0000-000000000000"}
        },
        "zava-sales-analysis-seattle": {
            "url": "http://127.0.0.1:8000/mcp",
            "type": "http", 
            "headers": {"x-rls-user-id": "f47ac10b-58cc-4372-a567-0e02b2c3d479"}
        }
    }
}
```

#### рзи. **ржХрзЛржпрж╝рзЗрж░рж┐ ржЙржжрж╛рж╣рж░ржг**

**рж╕рзНржХрж┐ржорж╛ ржЖржмрж┐рж╖рзНржХрж╛рж░:**
```
AI: #zava What tables are available in the database?
```
*MCP рж╕рж╛рж░рзНржнрж╛рж░ `get_multiple_table_schemas` ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЯрзЗржмрж┐рж▓ ржХрж╛ржарж╛ржорзЛ ржкрзНрж░ржжрж╛ржи ржХрж░рзЗ*

**ржмрж┐ржХрзНрж░ржпрж╝ ржмрж┐рж╢рзНрж▓рзЗрж╖ржг:**
```
AI: #zava Show me the top 10 products by revenue last quarter
```
*ржпржерж╛ржпрже ржЬржпрж╝рзЗржи ржПржмржВ рждрж╛рж░рж┐ржЦ ржлрж┐рж▓рзНржЯрж╛рж░рж┐ржВ рж╕рж╣ SQL рждрзИрж░рж┐ ржХрж░рзЗ*

**рж╕рзЗржорж╛ржирзНржЯрж┐ржХ рж╕рж╛рж░рзНржЪ:**
```
AI: #zava Find products similar to "waterproof electrical connectors"
```
*ржПржоржмрзЗржбрж┐ржВ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ рж╕рзЗржорж╛ржирзНржЯрж┐ржХржнрж╛ржмрзЗ ржЕржирзБрж░рзВржк ржкржгрзНржп ржЦрзБржБржЬрзЗ ржкрж╛ржпрж╝*

**ржорж╛рж▓рзНржЯрж┐-рж╕рзНржЯрзЛрж░ ржмрж┐рж╢рзНрж▓рзЗрж╖ржг:**
```
# Switch to Seattle store manager context
AI: #zava-seattle What are our best-selling categories this month?
```
*RLS ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзЗ рж╢рзБржзрзБржорж╛рждрзНрж░ рж╕рж┐ржпрж╝рж╛ржЯрж▓ рж╕рзНржЯрзЛрж░рзЗрж░ ржбрзЗржЯрж╛ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рж╛ рж╣ржпрж╝*

### ржЙржирзНржиржд ржХрзЛржпрж╝рзЗрж░рж┐ ржкрзНржпрж╛ржЯрж╛рж░рзНржи

#### рзз. **ржЯрж╛ржЗржо-рж╕рж┐рж░рж┐ржЬ ржмрж┐рж╢рзНрж▓рзЗрж╖ржг**
```sql
-- Generated by AI through MCP server
SELECT 
    DATE_TRUNC('month', o.order_date) as month,
    SUM(oi.total_amount) as revenue,
    COUNT(DISTINCT o.order_id) as order_count
FROM retail.orders o
JOIN retail.order_items oi ON o.order_id = oi.order_id
WHERE o.order_date >= CURRENT_DATE - INTERVAL '12 months'
GROUP BY DATE_TRUNC('month', o.order_date)
ORDER BY month;
```

#### рзи. **ржкржгрзНржп ржХрж░рзНржоржХрзНрж╖ржорждрж╛ ржмрж┐ржнрж╛ржЧ рж╕рж╣**
```sql
-- AI generates complex joins using schema information
SELECT 
    c.category_name,
    pt.type_name,
    COUNT(DISTINCT p.product_id) as product_count,
    SUM(oi.total_amount) as total_revenue,
    AVG(oi.unit_price) as avg_price
FROM retail.products p
JOIN retail.categories c ON p.category_id = c.category_id
JOIN retail.product_types pt ON p.product_type_id = pt.product_type_id
JOIN retail.order_items oi ON p.product_id = oi.product_id
GROUP BY c.category_name, pt.type_name
ORDER BY total_revenue DESC;
```

---

## ржЙржирзНржиржд ржмрзИрж╢рж┐рж╖рзНржЯрзНржп

### Row Level Security ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржи

#### рзз. **ржирзАрждрж┐ржорж╛рж▓рж╛ рждрзИрж░рж┐**
```sql
-- Store-based access control
CREATE POLICY customer_store_policy ON retail.customers
  FOR ALL TO PUBLIC
  USING (store_id = get_current_store_id());

CREATE POLICY order_store_policy ON retail.orders  
  FOR ALL TO PUBLIC
  USING (store_id = get_current_store_id());

-- Function to get current user's store
CREATE OR REPLACE FUNCTION get_current_store_id()
RETURNS uuid AS $$
BEGIN
  RETURN current_setting('app.current_rls_user_id')::uuid;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

#### рзи. **MCP рж╕рж╛рж░рзНржнрж╛рж░рзЗ ржкрзНрж░рж╕ржЩрзНржЧ рж╕рзЗржЯрж┐ржВ**
```python
async def execute_query(self, sql_query: str, rls_user_id: str) -> str:
    """Execute query with RLS context."""
    conn = await self.get_connection()
    
    # Set RLS context for this connection
    await conn.execute(
        "SELECT set_config('app.current_rls_user_id', $1, false)", 
        rls_user_id
    )
    
    # Execute user query with RLS filtering
    rows = await conn.fetch(sql_query)
    return self.format_results(rows)
```

### рж╕рзЗржорж╛ржирзНржЯрж┐ржХ рж╕рж╛рж░рзНржЪ ржмрж┐рж╢рзНрж▓рзЗрж╖ржг

#### рзз. **ржПржоржмрзЗржбрж┐ржВ ржкрж╛ржЗржкрж▓рж╛ржЗржи**
```python
# Generate embeddings for product descriptions
async def generate_product_embeddings():
    products = await get_all_products()
    
    for product in products:
        description = f"{product.name} {product.description} {product.category}"
        embedding = embedding_client.generate_embedding(description)
        
        await store_embedding(product.id, embedding)
```

#### рзи. **рж╕рж╛ржжрзГрж╢рзНржп ржЕржирзБрж╕ржирзНржзрж╛ржи ржЕржкрзНржЯрж┐ржорж╛ржЗржЬрзЗрж╢ржи**
```sql
-- Create vector index for performance
CREATE INDEX idx_product_embeddings_vector 
ON retail.product_description_embeddings 
USING ivfflat (description_embedding vector_cosine_ops);

-- Optimized similarity query
SELECT p.*, 
       (pde.description_embedding <=> $1::vector) as distance,
       (1 - (pde.description_embedding <=> $1::vector)) * 100 as similarity_percent
FROM retail.product_description_embeddings pde
JOIN retail.products p ON pde.product_id = p.product_id
WHERE (pde.description_embedding <=> $1::vector) < 0.7  -- 30% similarity threshold
ORDER BY distance
LIMIT 20;
```

### ржкрж░рзНржпржмрзЗржХрзНрж╖ржг ржПржмржВ ржкрж░рзНржпржмрзЗржХрзНрж╖ржгржпрзЛржЧрзНржпрждрж╛

#### рзз. **Azure Application Insights ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи**
```python
# Configure telemetry
from azure.monitor.opentelemetry import configure_azure_monitor
from opentelemetry.instrumentation.starlette import StarletteInstrumentor

# Enable monitoring if configured
if config.applicationinsights_connection_string:
    configure_azure_monitor(
        connection_string=config.applicationinsights_connection_string
    )
    StarletteInstrumentor().instrument_app(mcp.sse_app())
```

#### рзи. **ржХрж╛рж╕рзНржЯржо ржорзЗржЯрзНрж░рж┐ржХ ржПржмржВ рж▓ржЧрж┐ржВ**
```python
# Query execution tracking
@contextmanager
async def track_query_execution(query_type: str):
    start_time = time.time()
    try:
        yield
        duration = time.time() - start_time
        logger.info("Query executed", extra={
            "query_type": query_type,
            "duration_ms": duration * 1000,
            "status": "success"
        })
    except Exception as e:
        duration = time.time() - start_time
        logger.error("Query failed", extra={
            "query_type": query_type,
            "duration_ms": duration * 1000,
            "status": "error",
            "error": str(e)
        })
        raise
```

---

## рж╕ржорж╕рзНржпрж╛рж░ рж╕ржорж╛ржзрж╛ржи

### рж╕рж╛ржзрж╛рж░ржг рж╕ржорж╕рзНржпрж╛ ржПржмржВ рж╕ржорж╛ржзрж╛ржи

#### рзз. **ржбрзЗржЯрж╛ржмрзЗрж╕ рж╕ржВржпрзЛржЧ рж╕ржорж╕рзНржпрж╛**
```python
# Connection diagnostics
async def diagnose_connection():
    try:
        pool = await asyncpg.create_pool(**connection_params, min_size=1)
        conn = await pool.acquire()
        result = await conn.fetchval("SELECT 1")
        await pool.release(conn)
        await pool.close()
        return True
    except Exception as e:
        logger.error("Connection failed: %s", e)
        return False
```

**рж╕рж╛ржзрж╛рж░ржг рж╕ржорж╛ржзрж╛ржи:**
- ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржи PostgreSQL ржЪрж▓ржЫрзЗ: `docker ps`
- `.env`-ржП рж╕ржВржпрзЛржЧ ржкрзНржпрж╛рж░рж╛ржорж┐ржЯрж╛рж░ ржЪрзЗржХ ржХрж░рзБржи
- ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржи ржбрзЗржЯрж╛ржмрзЗрж╕ ржмрж┐ржжрзНржпржорж╛ржи: `docker exec -it pg17 psql -U postgres -l`
- ржирзЗржЯржУржпрж╝рж╛рж░рзНржХ рж╕ржВржпрзЛржЧ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи: `telnet localhost 5432`

#### рзи. **RLS ржирзАрждрж┐ржорж╛рж▓рж╛ рж╕ржорж╕рзНржпрж╛**
```sql
-- Debug RLS policies
SELECT schemaname, tablename, policyname, cmd, qual 
FROM pg_policies 
WHERE schemaname = 'retail';

-- Check current RLS setting
SELECT current_setting('app.current_rls_user_id');

-- Temporarily disable RLS for debugging
ALTER TABLE retail.orders DISABLE ROW LEVEL SECURITY;
```

#### рзй. **ржПржоржмрзЗржбрж┐ржВ ржкрж░рж┐рж╖рзЗржмрж╛ рж╕ржорж╕рзНржпрж╛**
```python
# Test embedding generation
async def test_embeddings():
    try:
        test_text = "waterproof electrical connector"
        embedding = embedding_client.generate_embedding(test_text)
        logger.info("Embedding generated successfully: %d dimensions", len(embedding))
        return True
    except Exception as e:
        logger.error("Embedding test failed: %s", e)
        return False
```

### ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржЕржкрзНржЯрж┐ржорж╛ржЗржЬрзЗрж╢ржи

#### рзз. **рж╕ржВржпрзЛржЧ ржкрзБрж▓ ржЯрж┐ржЙржирж┐ржВ**
```python
# Optimize for your workload
connection_pool = await asyncpg.create_pool(
    min_size=2,          # Minimum connections
    max_size=10,         # Maximum connections  
    max_inactive_connection_lifetime=300,  # 5 minutes
    command_timeout=30,   # Query timeout
    server_settings={
        "application_name": "mcp-server",
        "work_mem": "4MB",
        "shared_preload_libraries": "pg_stat_statements"
    }
)
```

#### рзи. **ржХрзЛржпрж╝рзЗрж░рж┐ ржЕржкрзНржЯрж┐ржорж╛ржЗржЬрзЗрж╢ржи**
```sql
-- Add indexes for common query patterns
CREATE INDEX idx_orders_store_date 
ON retail.orders (store_id, order_date);

CREATE INDEX idx_order_items_product 
ON retail.order_items (product_id);

-- Analyze query performance
EXPLAIN (ANALYZE, BUFFERS) 
SELECT ... FROM retail.orders o JOIN retail.order_items oi ...;
```

---

## рж╕рзЗрж░рж╛ ржЕржирзБрж╢рзАрж▓ржи

### ржирж┐рж░рж╛ржкрждрзНрждрж╛ рж╕рзЗрж░рж╛ ржЕржирзБрж╢рзАрж▓ржи

#### рзз. **ржкрж░рж┐ржмрзЗрж╢ ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓ ржмрзНржпржмрж╕рзНржерж╛ржкржирж╛**
```bash
# Use strong, unique passwords
POSTGRES_PASSWORD=$(openssl rand -base64 32)

# Rotate service principal credentials regularly
az ad sp credential reset --id $SP_ID --credential-description "Rotated $(date)"

# Use Azure Key Vault in production
az keyvault secret set --vault-name $VAULT_NAME --name "db-password" --value $PASSWORD
```

#### рзи. **RLS ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржи ржирж┐рж░рзНржжрзЗрж╢рж┐ржХрж╛**
- **ржбрж┐ржлрж▓рзНржЯ ржбрж┐ржирж╛ржЗ**: рж╕рзАржорж╛ржмржжрзНржз ржирзАрждрж┐ржорж╛рж▓рж╛ ржжрж┐ржпрж╝рзЗ рж╢рзБрж░рзБ ржХрж░рзБржи
- **ржирж┐ржпрж╝ржорж┐ржд ржЕржбрж┐ржЯ**: ржирзАрждрж┐ржорж╛рж▓рж╛рж░ ржХрж╛рж░рзНржпржХрж╛рж░рж┐рждрж╛ ржкрж░рзНржпржмрзЗржХрзНрж╖ржг ржХрж░рзБржи
- **ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи**: ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржкрзНржпрж╛ржЯрж╛рж░рзНржи ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи
- **ржирзАрждрж┐ржорж╛рж▓рж╛ ржбржХрзБржорзЗржирзНржЯ ржХрж░рзБржи**: ржкрж░рж┐рж╖рзНржХрж╛рж░ ржбржХрзБржорзЗржирзНржЯрзЗрж╢ржи ржмржЬрж╛ржпрж╝ рж░рж╛ржЦрзБржи

#### рзй. **ржирзЗржЯржУржпрж╝рж╛рж░рзНржХ ржирж┐рж░рж╛ржкрждрзНрждрж╛**
```yaml
# Production docker-compose with network isolation
networks:
  internal:
    driver: bridge
    internal: true
  external:
    driver: bridge

services:
  postgres:
    networks:
      - internal
    # No external ports in production
  
  mcp_server:
    networks:
      - internal
      - external
    ports:
      - "127.0.0.1:8000:8000"  # Bind to localhost only
```

### ржбрзЗржнрзЗрж▓ржкржорзЗржирзНржЯ рж╕рзЗрж░рж╛ ржЕржирзБрж╢рзАрж▓ржи

#### рзз. **рждрзНрж░рзБржЯрж┐ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржкрзНржпрж╛ржЯрж╛рж░рзНржи**
```python
# Structured error responses
class MCPError(Exception):
    def __init__(self, message: str, error_type: str = "general"):
        self.message = message
        self.error_type = error_type
        super().__init__(message)

async def safe_execute_query(query: str, rls_user_id: str) -> str:
    try:
        return await db_provider.execute_query(query, rls_user_id)
    except asyncpg.PostgresError as e:
        logger.error("Database error: %s", e)
        return json.dumps({"error": "Database query failed", "type": "database"})
    except Exception as e:
        logger.error("Unexpected error: %s", e)
        return json.dumps({"error": "Internal server error", "type": "server"})
```

#### рзи. **ржкрж░рзАржХрзНрж╖рж╛рж░ ржХрзМрж╢рж▓**
```python
# Unit test example
@pytest.mark.asyncio
async def test_rls_isolation():
    """Test that RLS properly isolates store data."""
    
    # Test Seattle store manager
    seattle_results = await db_provider.execute_query(
        "SELECT COUNT(*) FROM retail.orders",
        rls_user_id="f47ac10b-58cc-4372-a567-0e02b2c3d479"
    )
    
    # Test Redmond store manager  
    redmond_results = await db_provider.execute_query(
        "SELECT COUNT(*) FROM retail.orders", 
        rls_user_id="e7f8a9b0-c1d2-3e4f-5678-90abcdef1234"
    )
    
    # Results should be different due to RLS
    assert seattle_results != redmond_results
```

#### рзй. **ржкрж░рзНржпржмрзЗржХрзНрж╖ржг ржПржмржВ рж╕рждрж░рзНржХрждрж╛**
```python
# Custom metrics for monitoring
from prometheus_client import Counter, Histogram, start_http_server

query_counter = Counter('mcp_queries_total', 'Total queries executed', ['query_type'])
query_duration = Histogram('mcp_query_duration_seconds', 'Query execution time')

@query_duration.time()
async def execute_query_with_metrics(query: str, rls_user_id: str):
    query_counter.labels(query_type='sales_analysis').inc()
    return await db_provider.execute_query(query, rls_user_id)
```

### ржорзЛрждрж╛ржпрж╝рзЗржи рж╕рзЗрж░рж╛ ржЕржирзБрж╢рзАрж▓ржи

#### рзз. **Infrastructure as Code**
```bicep
// Use parameter files for different environments
param environment string = 'dev'
param location string = 'westus2'

// Apply consistent naming conventions
var resourcePrefix = 'zava-mcp-${environment}'
var resourceGroupName = 'rg-${resourcePrefix}-${uniqueSuffix}'

// Use tags for resource management
var commonTags = {
  Environment: environment
  Project: 'zava-mcp-server'
  ManagedBy: 'bicep'
  CreatedDate: utcNow('yyyy-MM-dd')
}
```

#### рзи. **CI/CD ржкрж╛ржЗржкрж▓рж╛ржЗржи ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи**
```yaml
# Azure DevOps pipeline example
- task: AzureCLI@2
  displayName: 'Deploy Infrastructure'
  inputs:
    azureSubscription: $(azureServiceConnection)
    scriptType: 'bash'
    scriptLocation: 'inlineScript'
    inlineScript: |
      az deployment sub create \
        --name "mcp-server-$(Build.BuildId)" \
        --location $(location) \
        --template-file infra/main.bicep \
        --parameters environment=$(environment)

- task: Docker@2
  displayName: 'Build and Push MCP Server'
  inputs:
    command: 'buildAndPush'
    repository: 'zava-mcp-server'
    tags: '$(Build.BuildId)'
```

---

ржПржЗ ржмрж┐рж╕рзНрждрзГржд ржирж┐рж░рзНржжрзЗрж╢рж┐ржХрж╛ ржПржХржЯрж┐ ржкрзНрж░рзЛржбрж╛ржХрж╢ржи-рж░рзЗржбрж┐ MCP рж╕рж╛рж░рзНржнрж╛рж░ PostgreSQL ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржирзЗрж░ рж╕рж╛ржерзЗ рждрзИрж░рж┐, ржорзЛрждрж╛ржпрж╝рзЗржи ржПржмржВ ржкрж░рж┐ржЪрж╛рж▓ржирж╛рж░ ржЬржирзНржп ржнрж┐рждрзНрждрж┐ ржкрзНрж░ржжрж╛ржи ржХрж░рзЗред ржПржЦрж╛ржирзЗ ржкрзНрж░ржжрж░рзНрж╢рж┐ржд ржкрзНржпрж╛ржЯрж╛рж░рзНржи ржПржмржВ ржЕржирзБрж╢рзАрж▓ржиржЧрзБрж▓рж┐ ржирж┐рж░рж╛ржкрждрзНрждрж╛, ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржПржмржВ рж░ржХрзНрж╖ржгрж╛ржмрзЗржХрзНрж╖ржг ржмржЬрж╛ржпрж╝ рж░рзЗржЦрзЗ ржЕржирзНржпрж╛ржирзНржп ржбрзЛржорзЗржЗржи ржПржмржВ ржмрзНржпржмрж╣рж╛рж░ ржХрзНрж╖рзЗрждрзНрж░рзЗ ржкрзНрж░рж╕рж╛рж░рж┐ржд ржХрж░рж╛ ржпрзЗрждрзЗ ржкрж╛рж░рзЗред

---

**ржЕрж╕рзНржмрзАржХрзГрждрж┐**:  
ржПржЗ ржиржерж┐ржЯрж┐ AI ржЕржирзБржмрж╛ржж ржкрж░рж┐рж╖рзЗржмрж╛ [Co-op Translator](https://github.com/Azure/co-op-translator) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЕржирзБржмрж╛ржж ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред ржЖржорж░рж╛ ржпржерж╛рж╕рж╛ржзрзНржп рж╕ржарж┐ржХрждрж╛рж░ ржЬржирзНржп ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рж┐, рждржмрзЗ ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржоржирзЗ рж░рж╛ржЦржмрзЗржи ржпрзЗ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ ржЕржирзБржмрж╛ржжрзЗ рждрзНрж░рзБржЯрж┐ ржмрж╛ ржЕрж╕ржЩрзНржЧрждрж┐ ржерж╛ржХрждрзЗ ржкрж╛рж░рзЗред ржорзВрж▓ ржнрж╛рж╖рж╛ржпрж╝ ржерж╛ржХрж╛ ржиржерж┐ржЯрж┐ржХрзЗ ржкрзНрж░рж╛ржорж╛ржгрж┐ржХ ржЙрзОрж╕ рж╣рж┐рж╕рзЗржмрзЗ ржмрж┐ржмрзЗржЪржирж╛ ржХрж░рж╛ ржЙржЪрж┐рждред ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг рждржерзНржпрзЗрж░ ржЬржирзНржп, ржкрзЗрж╢рж╛ржжрж╛рж░ ржорж╛ржиржм ржЕржирзБржмрж╛ржж рж╕рзБржкрж╛рж░рж┐рж╢ ржХрж░рж╛ рж╣ржпрж╝ред ржПржЗ ржЕржирзБржмрж╛ржж ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржлрж▓рзЗ ржХрзЛржирзЛ ржнрзБрж▓ ржмрзЛржЭрж╛ржмрзБржЭрж┐ ржмрж╛ ржнрзБрж▓ ржмрзНржпрж╛ржЦрзНржпрж╛ рж╣рж▓рзЗ ржЖржорж░рж╛ ржжрж╛ржпрж╝ржмржжрзНржз ржерж╛ржХржм ржирж╛ред