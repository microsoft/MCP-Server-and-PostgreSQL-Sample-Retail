<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "c86955fe1dbaafcb4540d8875649e2f5",
  "translation_date": "2025-09-29T19:44:41+00:00",
  "source_file": "Sample_Walkthrough.md",
  "language_code": "ne"
}
-->
# MCP рд╕рд░реНрднрд░ рд░ PostgreSQL рдирдореВрдирд╛ - рдкреВрд░реНрдг рдорд╛рд░реНрдЧрджрд░реНрд╢рди

## рд╕рд╛рдордЧреНрд░реА рддрд╛рд▓рд┐рдХрд╛
1. [рдкрд░рд┐рдЪрдп](../..)
2. [рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдЧрд╣рд┐рд░реЛ рдЕрдзреНрдпрдпрди](../..)
3. [рд╕рдорд╛рдзрд╛рди рдирд┐рд░реНрдорд╛рдг](../..)
4. [рдШрдЯрдХ рд╡рд┐рд╡рд░рдг](../..)
5. [рдкрд░рд┐рдирд┐рдпреЛрдЬрди рдорд╛рд░реНрдЧрджрд░реНрд╢рди](../..)
6. [рд╕рдорд╛рдзрд╛рди рдкреНрд░рдпреЛрдЧ](../..)
7. [рдЙрдиреНрдирдд рд╕реБрд╡рд┐рдзрд╛рд╣рд░реВ](../..)
8. [рд╕рдорд╕реНрдпрд╛ рд╕рдорд╛рдзрд╛рди](../..)
9. [рд╕рд░реНрд╡реЛрддреНрддрдо рдЕрднреНрдпрд╛рд╕рд╣рд░реВ](../..)

## рдкрд░рд┐рдЪрдп

рдпреЛ рдорд╛рд░реНрдЧрджрд░реНрд╢рдирд▓реЗ рдЙрддреНрдкрд╛рджрди-рддрдпрд╛рд░ **рдореЛрдбреЗрд▓ рдХрдиреНрдЯреЗрдХреНрд╕реНрдЯ рдкреНрд░реЛрдЯреЛрдХрд▓ (MCP) рд╕рд░реНрднрд░** рдирд┐рд░реНрдорд╛рдг рд░ рдкреНрд░рдпреЛрдЧ рдЧрд░реНрдиреЗ рддрд░рд┐рдХрд╛ рд╡реНрдпрд╛рдЦреНрдпрд╛ рдЧрд░реНрджрдЫ, рдЬрд╕рд▓реЗ PostgreSQL рд░ Azure AI рд╕реЗрд╡рд╛рд╣рд░реВрд▓рд╛рдИ рдПрдХреАрдХреГрдд рдЧрд░реНрджрдЫред рдирдореВрдирд╛рд▓реЗ рдЙрджреНрдпрдо-рд╕реНрддрд░реАрдп рдврд╛рдБрдЪрд╛рд╣рд░реВ рдкреНрд░рджрд░реНрд╢рди рдЧрд░реНрджрдЫ, рдЬрд╕реНрддреИ рд░реЛ рд▓реЗрднрд▓ рд╕реБрд░рдХреНрд╖рд╛, рд╕реЗрдореНрдпрд╛рдиреНрдЯрд┐рдХ рдЦреЛрдЬ, рд░ рдмрд╣реБ-рднрд╛рдбрд╛рд╡рд╛рд▓ рдбрд╛рдЯрд╛ рдкрд╣реБрдБрдЪред

### рддрдкрд╛рдИрдВрд▓реЗ рдХреЗ рд╕рд┐рдХреНрдиреБрд╣реБрдиреЗрдЫ
- рдбреЗрдЯрд╛рдмреЗрд╕ рдПрдХреАрдХрд░рдгрд╕рд╣рд┐рдд MCP рд╕рд░реНрднрд░рдХреЛ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдХрд╕рд░реА рдмрдирд╛рдЙрдиреЗ
- рдмрд╣реБ-рднрд╛рдбрд╛рд╡рд╛рд▓ рдкрд░рд┐рджреГрд╢реНрдпрд╣рд░реВрдХреЛ рд▓рд╛рдЧрд┐ рд░реЛ рд▓реЗрднрд▓ рд╕реБрд░рдХреНрд╖рд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди
- Azure OpenAI рдЗрдореНрдмреЗрдбрд┐рдЩреНрд╕рдХреЛ рд╕рд╛рде рд╕реЗрдореНрдпрд╛рдиреНрдЯрд┐рдХ рдЦреЛрдЬ рдирд┐рд░реНрдорд╛рдг
- Docker-рдЖрдзрд╛рд░рд┐рдд рд╡рд┐рдХрд╛рд╕ рд╡рд╛рддрд╛рд╡рд░рдг рд╕рд┐рд░реНрдЬрдирд╛
- Bicep рдЯреЗрдореНрдкреНрд▓реЗрдЯрд╣рд░реВрдХреЛ рд╕рд╛рде Azure рдкреВрд░реНрд╡рд╛рдзрд╛рд░ рдкрд░рд┐рдирд┐рдпреЛрдЬрди
- AI-рд╕рдВрдЪрд╛рд▓рд┐рдд рдПрдирд╛рд▓рд┐рдЯрд┐рдХреНрд╕рдХреЛ рд▓рд╛рдЧрд┐ VS Code рдПрдХреАрдХрд░рдг

### рдкреНрд░рдпреЛрдЧ рдЧрд░рд┐рдПрдХрд╛ рдкреНрд░рд╡рд┐рдзрд┐рд╣рд░реВ
- **MCP рдкреНрд░реЛрдЯреЛрдХрд▓**: AI рдЙрдкрдХрд░рдг рдПрдХреАрдХрд░рдгрдХреЛ рд▓рд╛рдЧрд┐ рдореЛрдбреЗрд▓ рдХрдиреНрдЯреЗрдХреНрд╕реНрдЯ рдкреНрд░реЛрдЯреЛрдХрд▓
- **FastMCP**: рдЖрдзреБрдирд┐рдХ Python MCP рд╕рд░реНрднрд░ рдлреНрд░реЗрдорд╡рд░реНрдХ
- **PostgreSQL**: pgvector рд╡рд┐рд╕реНрддрд╛рд░рд╕рд╣рд┐рддрдХреЛ рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗрдореНрдпрд╛рдиреНрдЯрд┐рдХ рдЦреЛрдЬрдХреЛ рд▓рд╛рдЧрд┐
- **Azure OpenAI**: рдкрд╛рда рдЗрдореНрдмреЗрдбрд┐рдЩреНрд╕ рд░ рд╡реИрдХрд▓реНрдкрд┐рдХ GPT рдореЛрдбреЗрд▓рд╣рд░реВ
- **Docker**: рд╕реБрд╕рдВрдЧрдд рд╡рд╛рддрд╛рд╡рд░рдгрдХреЛ рд▓рд╛рдЧрд┐ рдХрдиреНрдЯреЗрдирд░рд╛рдЗрдЬреЗрд╢рди
- **Bicep**: Azure рд╕реНрд░реЛрддрд╣рд░реВрдХреЛ рд▓рд╛рдЧрд┐ рдХреЛрдбрдХреЛ рдкреВрд░реНрд╡рд╛рдзрд╛рд░
- **VS Code**: MCP рдПрдХреАрдХрд░рдгрд╕рд╣рд┐рддрдХреЛ рд╡рд┐рдХрд╛рд╕ рд╡рд╛рддрд╛рд╡рд░рдг

## ЁЯУЪ рд╕рдВрд░рдЪрд┐рдд рд╕рд┐рдХрд╛рдЗ рдорд╛рд░реНрдЧрджрд░реНрд╢рди: /walkthrough

рдпрд╕ рдкреНрд░рд╛рд╡рд┐рдзрд┐рдХ рдорд╛рд░реНрдЧрджрд░реНрд╢рдирдХреЛ рдЕрддрд┐рд░рд┐рдХреНрдд, рдпреЛ рд░рд┐рдкреЛрдЬрд┐рдЯрд░реАрдорд╛ **резреи-рдореЛрдбреНрдпреБрд▓ рд╕рд┐рдХрд╛рдЗ рдорд╛рд░реНрдЧрджрд░реНрд╢рди** рд╕рдорд╛рд╡реЗрд╢ рдЫ, рдЬреБрди `/walkthrough` рдбрд╛рдЗрд░реЗрдХреНрдЯрд░реАрдорд╛ рдЕрд╡рд╕реНрдерд┐рдд рдЫред рдпреЛ рд╕рдВрд░рдЪрд┐рдд рджреГрд╖реНрдЯрд┐рдХреЛрдгрд▓реЗ рдЬрдЯрд┐рд▓ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрдирд▓рд╛рдИ рдкрдЪрд╛рдЙрди рд╕рдХрд┐рдиреЗ рд╕рд┐рдХрд╛рдЗ рдореЛрдбреНрдпреБрд▓рд╣рд░реВрдорд╛ рд╡рд┐рднрд╛рдЬрди рдЧрд░реНрджрдЫ, рд╡рд┐рдХрд╛рд╕рдХрд░реНрддрд╛рд╣рд░реВрдХрд╛ рд▓рд╛рдЧрд┐ рдкреНрд░рддреНрдпреЗрдХ рдШрдЯрдХрд▓рд╛рдИ рдЪрд░рдг-рджрд░-рдЪрд░рдг рдмреБрдЭреНрди рдЙрдкрдпреБрдХреНрддред

### рд╕рд┐рдХрд╛рдЗ рдореЛрдбреНрдпреБрд▓рд╣рд░реВрдХреЛ рдЕрд╡рд▓реЛрдХрди

| рдореЛрдбреНрдпреБрд▓ | рд╡рд┐рд╖рдп | рдХреЗрдиреНрджреНрд░рдмрд┐рдиреНрджреБ | рдЕрд╡рдзрд┐ |
|--------|-------|-------|----------|
| **[00-Introduction](walkthrough/00-Introduction/README.md)** | MCP рдЖрдзрд╛рд░рднреВрдд | рдореБрдЦреНрдп рдЕрд╡рдзрд╛рд░рдгрд╛рд╣рд░реВ, Zava Retail рдХреЗрд╕ рдЕрдзреНрдпрдпрди, рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдЕрд╡рд▓реЛрдХрди | рейреж рдорд┐рдиреЗрдЯ |
| **[01-Architecture](walkthrough/01-Architecture/README.md)** | рдкреНрд░рдгрд╛рд▓реА рдбрд┐рдЬрд╛рдЗрди | рдкреНрд░рд╛рд╡рд┐рдзрд┐рдХ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░, рдбрд┐рдЬрд╛рдЗрди рдврд╛рдБрдЪрд╛рд╣рд░реВ, рдШрдЯрдХ рд╕рдореНрдмрдиреНрдзрд╣рд░реВ | рекрел рдорд┐рдиреЗрдЯ |
| **[02-Security](walkthrough/02-Security/README.md)** | рдЙрджреНрдпрдо рд╕реБрд░рдХреНрд╖рд╛ | Azure рдкреНрд░рдорд╛рдгреАрдХрд░рдг, рд░реЛ рд▓реЗрднрд▓ рд╕реБрд░рдХреНрд╖рд╛, рдмрд╣реБ-рднрд╛рдбрд╛рд╡рд╛рд▓ рдЕрд▓рдЧрд╛рд╡ | ремреж рдорд┐рдиреЗрдЯ |
| **[03-Setup](walkthrough/03-Setup/README.md)** | рд╡рд╛рддрд╛рд╡рд░рдг рд╕реЗрдЯрдЕрдк | Docker рдХрдиреНрдлрд┐рдЧрд░реЗрд╕рди, Azure CLI, рдкрд░рд┐рдпреЛрдЬрдирд╛ рдЖрд░рдореНрдн | рекрел рдорд┐рдиреЗрдЯ |
| **[04-Database](walkthrough/04-Database/README.md)** | рдбрд╛рдЯрд╛ рддрд╣ | PostgreSQL рд╕реНрдХреАрдорд╛, pgvector рд╕реЗрдЯрдЕрдк, RLS рдиреАрддрд┐рд╣рд░реВ, рдирдореВрдирд╛ рдбрд╛рдЯрд╛ | ремреж рдорд┐рдиреЗрдЯ |
| **[05-MCP-Server](walkthrough/05-MCP-Server/README.md)** | рдореБрдЦреНрдп рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди | FastMCP рдлреНрд░реЗрдорд╡рд░реНрдХ, рдбреЗрдЯрд╛рдмреЗрд╕ рдПрдХреАрдХрд░рдг, рдЙрдкрдХрд░рдг рд╡рд┐рдХрд╛рд╕ | репреж рдорд┐рдиреЗрдЯ |
| **[06-Tools](walkthrough/06-Tools/README.md)** | рдЙрдкрдХрд░рдг рд╡рд┐рдХрд╛рд╕ | MCP рдЙрдкрдХрд░рдг рд╕рд┐рд░реНрдЬрдирд╛, рдХреНрд╡реЗрд░реА рдорд╛рдиреНрдпрддрд╛, рд╡реНрдпрд╡рд╕рд╛рдпрд┐рдХ рдмреБрджреНрдзрд┐рдорддреНрддрд╛ | ренрел рдорд┐рдиреЗрдЯ |
| **[07-Semantic-Search](walkthrough/07-Semantic-Search/README.md)** | AI рдПрдХреАрдХрд░рдг | Azure OpenAI рдЗрдореНрдмреЗрдбрд┐рдЩреНрд╕, рднреЗрдХреНрдЯрд░ рдЦреЛрдЬ, рд╣рд╛рдЗрдмреНрд░рд┐рдб рдХреНрд╡реЗрд░реАрд╣рд░реВ | ремреж рдорд┐рдиреЗрдЯ |
| **[08-Testing](walkthrough/08-Testing/README.md)** | рдЧреБрдгрд╕реНрддрд░ рдЖрд╢реНрд╡рд╛рд╕рди | рдкрд░реАрдХреНрд╖рдг рд░рдгрдиреАрддрд┐рд╣рд░реВ, рдбрд┐рдмрдЧрд┐рдЩ рдкреНрд░рд╡рд┐рдзрд┐рд╣рд░реВ, рдкреНрд░рджрд░реНрд╢рди рдкрд░реАрдХреНрд╖рдг | ренрел рдорд┐рдиреЗрдЯ |
| **[09-VS-Code](walkthrough/09-VS-Code/README.md)** | рд╡рд┐рдХрд╛рд╕ рдЕрдиреБрднрд╡ | VS Code рдХрдиреНрдлрд┐рдЧрд░реЗрд╕рди, AI рдЪреНрдпрд╛рдЯ рдПрдХреАрдХрд░рдг, рдбрд┐рдмрдЧрд┐рдЩ рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣рд╣рд░реВ | рекрел рдорд┐рдиреЗрдЯ |
| **[10-Deployment](walkthrough/10-Deployment/README.md)** | рдЙрддреНрдкрд╛рджрди рдкрд░рд┐рдирд┐рдпреЛрдЬрди | рдХрдиреНрдЯреЗрдирд░рд╛рдЗрдЬреЗрд╢рди, Azure Container Apps, CI/CD рдкрд╛рдЗрдкрд▓рд╛рдЗрдирд╣рд░реВ | репреж рдорд┐рдиреЗрдЯ |
| **[11-Monitoring](walkthrough/11-Monitoring/README.md)** | рдЕрд╡рд▓реЛрдХрдирд╢реАрд▓рддрд╛ | рдПрдкреНрд▓рд┐рдХреЗрд╕рди рдЗрдирд╕рд╛рдЗрдЯреНрд╕, рд╕рдВрд░рдЪрд┐рдд рд▓рдЧрд┐рдЩ, рдкреНрд░рджрд░реНрд╢рди рдореЗрдЯреНрд░рд┐рдХреНрд╕ | ремреж рдорд┐рдиреЗрдЯ |
| **[12-Best-Practices](walkthrough/12-Best-Practices/README.md)** | рдЙрддреНрдкрд╛рджрди рдЙрддреНрдХреГрд╖реНрдЯрддрд╛ | рд╕реБрд░рдХреНрд╖рд╛ рдХрдбрд╛ рдмрдирд╛рдЙрдиреЗ, рдЕрдиреБрдХреВрд▓рди, рдЙрджреНрдпрдо рдврд╛рдБрдЪрд╛рд╣рд░реВ | рекрел рдорд┐рдиреЗрдЯ |

### рд╕рд┐рдХрд╛рдЗ рдорд╛рд░реНрдЧрджрд░реНрд╢рди рдкреНрд░рдпреЛрдЧ рдЧрд░реНрдиреЗ рддрд░рд┐рдХрд╛

**ЁЯУЦ рд╕рд┐рдХрд╛рдЗрдХреЛ рд▓рд╛рдЧрд┐**: `/walkthrough` рдореЛрдбреНрдпреБрд▓рд╣рд░реВрд▓реЗ рдЪрд░рдг-рджрд░-рдЪрд░рдг рдирд┐рд░реНрджреЗрд╢рдирд╣рд░реВ рдкреНрд░рджрд╛рди рдЧрд░реНрджрдЫ, рдкреНрд░рддреНрдпреЗрдХ рдШрдЯрдХ рдХрд┐рди рдпрд╕рд░реА рдбрд┐рдЬрд╛рдЗрди рдЧрд░рд┐рдПрдХреЛ рд╣реЛ рднрдиреНрдиреЗ рд╡реНрдпрд╛рдЦреНрдпрд╛рд╕рд╣рд┐рддред рдореЛрдбреНрдпреБрд▓ режреж рдмрд╛рдЯ рд╕реБрд░реБ рдЧрд░реНрдиреБрд╣реЛрд╕реН рд░ рдХреНрд░рдорд┐рдХ рд░реВрдкрдорд╛ рдЕрдЧрд╛рдбрд┐ рдмрдвреНрдиреБрд╣реЛрд╕реНред

**ЁЯФз рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрдирдХреЛ рд▓рд╛рдЧрд┐**: рдпреЛ Sample_Walkthrough.md рдкреНрд░рд╛рд╡рд┐рдзрд┐рдХ рдЧрд╣рд┐рд░реЛ рдЕрдзреНрдпрдпрди рд░ рдХреЛрдб рд╡рд┐рд╡рд░рдг рдкреНрд░рджрд╛рди рдЧрд░реНрджрдЫ, рдЬрд╕рд▓реЗ рд╡рд┐рдХрд╛рд╕рдХрд░реНрддрд╛рд╣рд░реВрд▓рд╛рдИ рдкреВрд░реНрдг рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдЫрд┐рдЯреЛ рдмреБрдЭреНрди рдорджреНрджрдд рдЧрд░реНрджрдЫред

**ЁЯЪА рдЙрддреНрдкрд╛рджрдирдХреЛ рд▓рд╛рдЧрд┐**: рдореЛрдбреНрдпреБрд▓рд╣рд░реВ режреи, резреж, резрез, рд░ резреи рд╡рд┐рд╢реЗрд╖ рд░реВрдкрдорд╛ рдЙрддреНрдкрд╛рджрди-рддрдпрд╛рд░ рдкрд░рд┐рдирд┐рдпреЛрдЬрди, рд╕реБрд░рдХреНрд╖рд╛, рд░ рдирд┐рдЧрд░рд╛рдиреА рд╡рд┐рдЪрд╛рд░рд╣рд░реВрдорд╛ рдХреЗрдиреНрджреНрд░рд┐рдд рдЫрдиреНред

**ЁЯУЪ рдкреВрд░реНрдг рд╕рд┐рдХрд╛рдЗ рдорд╛рд░реНрдЧ**: рд╡рд┐рд╕реНрддреГрдд рд╕рд┐рдХрд╛рдЗ рдЙрджреНрджреЗрд╢реНрдпрд╣рд░реВ рд░ рдкреВрд░реНрд╡рд╛рдкреЗрдХреНрд╖рд╛рд╣рд░реВрдХреЛ рд╕рд╛рде рдкреВрд░реНрдг рдорд╛рд░реНрдЧрджрд░реНрд╢рди рдЕрд╡рд▓реЛрдХрдирдХреЛ рд▓рд╛рдЧрд┐ **[/walkthrough/README.md](walkthrough/README.md)** рднреНрд░рдордг рдЧрд░реНрдиреБрд╣реЛрд╕реНред

---

## рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдЧрд╣рд┐рд░реЛ рдЕрдзреНрдпрдпрди

### рдЙрдЪреНрдЪ-рд╕реНрддрд░реАрдп рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░

```
тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР    тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР    тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
тФВ   VS Code AI    тФВ    тФВ   MCP Server    тФВ    тФВ   PostgreSQL    тФВ
тФВ     Client      тФВтЧДтФАтФАтЦ║тФВ  (FastMCP)      тФВтЧДтФАтФАтЦ║тФВ   + pgvector    тФВ
тФВ                 тФВ    тФВ                 тФВ    тФВ                 тФВ
тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ    тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ    тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
                                тФВ
                                тЦ╝
                       тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
                       тФВ  Azure OpenAI   тФВ
                       тФВ   Embeddings    тФВ
                       тФФтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФШ
```

### рдореБрдЦреНрдп рдШрдЯрдХрд╣рд░реВ

#### рез. **MCP рд╕рд░реНрднрд░ (`sales_analysis.py`)**
- **FastMCP рдлреНрд░реЗрдорд╡рд░реНрдХ**: HTTP/SSE рдкреНрд░реЛрдЯреЛрдХрд▓ рд╕рдЮреНрдЪрд╛рд░ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди
- **рдЙрдкрдХрд░рдг рджрд░реНрддрд╛**: рдбреЗрдЯрд╛рдмреЗрд╕ рдХреНрд╡реЗрд░реА рд░ рд╕реНрдХреАрдорд╛ рдЙрдкрдХрд░рдгрд╣рд░реВ рдЙрдЬрд╛рдЧрд░ рдЧрд░реНрджрдЫ
- **рдЕрдиреБрд░реЛрдз рд╕рдиреНрджрд░реНрдн**: RLS рдкреНрд░рдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╣рд┐рдЪрд╛рди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди
- **рддреНрд░реБрдЯрд┐ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди**: рдмрд▓рд┐рдпреЛ рддреНрд░реБрдЯрд┐ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди рд░ рд▓рдЧрд┐рдЩ

#### реи. **рдбреЗрдЯрд╛рдмреЗрд╕ рддрд╣ (`sales_analysis_postgres.py`)**
- **рдХрдиреЗрдХреНрд╢рди рдкреВрд▓рд┐рдЩ**: рдкреНрд░рднрд╛рд╡рдХрд╛рд░реА asyncpg рдХрдиреЗрдХреНрд╢рди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди
- **рд╕реНрдХреАрдорд╛ рдкреНрд░рджрд╛рдпрдХ**: рдЧрддрд┐рд╢реАрд▓ рддрд╛рд▓рд┐рдХрд╛ рд╕реНрдХреАрдорд╛ рдкрддреНрддрд╛ рд▓рдЧрд╛рдЙрдиреЗ
- **рдХреНрд╡реЗрд░реА рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди**: RLS рд╕рд╣рд┐рдд рд╕реБрд░рдХреНрд╖рд┐рдд SQL рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди
- **рд╕реЗрдореНрдпрд╛рдиреНрдЯрд┐рдХ рдЦреЛрдЬ**: pgvectorрдХреЛ рд╕рд╛рде рднреЗрдХреНрдЯрд░ рд╕рдорд╛рдирддрд╛ рдЦреЛрдЬ

#### рей. **рдХрдиреНрдлрд┐рдЧрд░реЗрд╕рди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди (`config.py`)**
- **рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░рд╣рд░реВ**: рдХреЗрдиреНрджреНрд░реАрдпрдХреГрдд рдХрдиреНрдлрд┐рдЧрд░реЗрд╕рди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди
- **рдХрдиреЗрдХреНрд╢рди рдкреНрдпрд╛рд░рд╛рдорд┐рдЯрд░рд╣рд░реВ**: рдбреЗрдЯрд╛рдмреЗрд╕ рд░ Azure рд╕реЗрд╡рд╛ рдХрдиреНрдлрд┐рдЧрд░реЗрд╕рди
- **рдорд╛рдиреНрдпрддрд╛**: рдЖрд╡рд╢реНрдпрдХ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рдорд╛рдиреНрдпрддрд╛

#### рек. **рдкреВрд░реНрд╡рд╛рдзрд╛рд░ (`infra/`)**
- **Bicep рдЯреЗрдореНрдкреНрд▓реЗрдЯрд╣рд░реВ**: Azure рд╕реНрд░реЛрддрд╣рд░реВрдХреЛ рдШреЛрд╖рдгрд╛рддреНрдордХ рдкреНрд░рд╛рд╡рдзрд╛рди
- **рдореЛрдбреЗрд▓ рдкрд░рд┐рдирд┐рдпреЛрдЬрди**: рд╕реНрд╡рдЪрд╛рд▓рд┐рдд AI рдореЛрдбреЗрд▓ рдкрд░рд┐рдирд┐рдпреЛрдЬрди
- **рднреВрдорд┐рдХрд╛ рдЕрд╕рд╛рдЗрдирдореЗрдиреНрдЯрд╣рд░реВ**: рд╕реБрд░рдХреНрд╖рд╛ рднреВрдорд┐рдХрд╛ рдХрдиреНрдлрд┐рдЧрд░реЗрд╕рди

### рдбрд╛рдЯрд╛ рдкреНрд░рд╡рд╛рд╣

```
1. VS Code AI Client sends query
2. MCP Server receives request with RLS headers
3. Server extracts user identity and sets context
4. Database queries execute with RLS filtering
5. Results return through MCP protocol
6. AI Client processes structured response
```

---

## рд╕рдорд╛рдзрд╛рди рдирд┐рд░реНрдорд╛рдг

### рдЪрд░рдг рез: рдкрд░рд┐рдпреЛрдЬрдирд╛ рд╕рдВрд░рдЪрдирд╛ рд╕реЗрдЯрдЕрдк

```
project/
тФЬтФАтФА mcp_server/              # MCP server implementation
тФВ   тФЬтФАтФА __init__.py         # Package initialization
тФВ   тФЬтФАтФА sales_analysis.py   # Main MCP server
тФВ   тФЬтФАтФА sales_analysis_postgres.py  # Database layer
тФВ   тФЬтФАтФА sales_analysis_text_embeddings.py  # Semantic search
тФВ   тФФтФАтФА config.py           # Configuration management
тФЬтФАтФА infra/                  # Infrastructure as Code
тФВ   тФЬтФАтФА main.bicep          # Main deployment template
тФВ   тФЬтФАтФА foundry.bicep       # Azure AI Foundry setup
тФВ   тФЬтФАтФА deploy.ps1          # Windows deployment script
тФВ   тФФтФАтФА deploy.sh           # Unix deployment script
тФЬтФАтФА data/                   # Database backup and initialization
тФЬтФАтФА docker-init/            # Database initialization scripts
тФЬтФАтФА .vscode/                # VS Code MCP configuration
тФЬтФАтФА docker-compose.yml      # Development environment
тФЬтФАтФА Dockerfile             # MCP server container
тФФтФАтФА requirements.lock.txt   # Python dependencies
```

### рдЪрд░рдг реи: рдореБрдЦреНрдп рдирд┐рд░реНрднрд░рддрд╛рд╣рд░реВ

**Python рдЖрд╡рд╢реНрдпрдХрддрд╛рд╣рд░реВ:**
```python
# MCP Framework
mcp[server]>=0.5.0
fastmcp>=0.4.0

# Database Integration
asyncpg>=0.29.0
asyncio-rlock>=0.3.0

# Azure Integration
azure-ai-projects>=1.0.0
azure-identity>=1.19.0
azure-monitor-opentelemetry>=1.7.0

# Data Processing
pydantic>=2.9.0
numpy>=1.24.0

# Development
python-dotenv>=1.0.0
```

**рдкреНрд░рдгрд╛рд▓реА рдЖрд╡рд╢реНрдпрдХрддрд╛рд╣рд░реВ:**
- рдХрдиреНрдЯреЗрдирд░рд╛рдЗрдЬреЗрд╢рдирдХреЛ рд▓рд╛рдЧрд┐ Docker Desktop
- рдкрд░рд┐рдирд┐рдпреЛрдЬрдирдХреЛ рд▓рд╛рдЧрд┐ Azure CLI
- pgvector рд╡рд┐рд╕реНрддрд╛рд░рд╕рд╣рд┐рддрдХреЛ PostgreSQL
- AI рд╡рд┐рд╕реНрддрд╛рд░рд╕рд╣рд┐рддрдХреЛ VS Code

### рдЪрд░рдг рей: рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реНрдХреАрдорд╛ рдбрд┐рдЬрд╛рдЗрди

рдирдореВрдирд╛рд▓реЗ рдпреА рдореБрдЦреНрдп рддрд╛рд▓рд┐рдХрд╛рд╣рд░реВ рднрдПрдХреЛ рдЦреБрджреНрд░рд╛ рдбреЗрдЯрд╛рдмреЗрд╕ рдкреНрд░рдпреЛрдЧ рдЧрд░реНрджрдЫ:

```sql
-- Core business entities
retail.stores          -- Store locations and metadata
retail.customers       -- Customer profiles
retail.categories      -- Product categorization
retail.product_types   -- Product type definitions
retail.products        -- Product catalog
retail.orders          -- Customer orders
retail.order_items     -- Order line items
retail.inventory       -- Stock levels

-- Semantic search support
retail.product_description_embeddings  -- Vector embeddings for products
```

**рд░реЛ рд▓реЗрднрд▓ рд╕реБрд░рдХреНрд╖рд╛ (RLS) рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди:**
```sql
-- Enable RLS on tables
ALTER TABLE retail.orders ENABLE ROW LEVEL SECURITY;
ALTER TABLE retail.customers ENABLE ROW LEVEL SECURITY;

-- Create policies based on store association
CREATE POLICY store_policy ON retail.orders
  FOR ALL TO PUBLIC
  USING (store_id = get_user_store_id());
```

---

## рдШрдЯрдХ рд╡рд┐рд╡рд░рдг

### MCP рд╕рд░реНрднрд░ рдХреЛрд░ (`sales_analysis.py`)

#### рдЙрдкрдХрд░рдг рджрд░реНрддрд╛ рдврд╛рдБрдЪрд╛
```python
@mcp.tool()
async def execute_sales_query(
    ctx: Context,
    postgresql_query: Annotated[str, Field(description="A well-formed PostgreSQL query.")],
) -> str:
    """Execute PostgreSQL queries with Row Level Security."""
    rls_user_id = get_rls_user_id(ctx)
    
    try:
        return await db_provider.execute_query(
            postgresql_query, rls_user_id=rls_user_id
        )
    except Exception as e:
        logger.error("Error executing database query: %s", e)
        return f"Error executing database query: {e!s}"
```

**рдореБрдЦреНрдп рд╕реБрд╡рд┐рдзрд╛рд╣рд░реВ:**
- **рдкреНрд░рдХрд╛рд░ рдПрдиреЛрдЯреЗрд╕рдирд╣рд░реВ**: AI рдмреБрдЭрд╛рдЗрдХреЛ рд▓рд╛рдЧрд┐ Pydantic рдХреНрд╖реЗрддреНрд░ рд╡рд┐рд╡рд░рдгрд╣рд░реВ
- **рд╕рдиреНрджрд░реНрдн рдирд┐рдХрд╛рд╕реА**: HTTP рд╣реЗрдбрд░рдмрд╛рдЯ рдкреНрд░рдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╣рд┐рдЪрд╛рди
- **рддреНрд░реБрдЯрд┐ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди**: рдЬрд╛рдирдХрд╛рд░реАрдореВрд▓рдХ рд╕рдиреНрджреЗрд╢рд╣рд░реВрд╕рд╣рд┐рддрдХреЛ рд╕рд╣рдЬ рдЕрд╕рдлрд▓рддрд╛
- **рд▓рдЧрд┐рдЩ**: рд╡реНрдпрд╛рдкрдХ рдЕрдкрд░реЗрд╢рди рд▓рдЧрд┐рдЩ

#### рдЕрдиреБрд░реЛрдз рд╕рдиреНрджрд░реНрдн рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди
```python
def get_rls_user_id(ctx: Context) -> str:
    """Extract Row Level Security User ID from request context."""
    rls_user_id = get_header(ctx, "x-rls-user-id")
    if rls_user_id is None:
        # Default to placeholder if not provided
        rls_user_id = "00000000-0000-0000-0000-000000000000"
    return rls_user_id
```

### рдбреЗрдЯрд╛рдмреЗрд╕ рддрд╣ (`sales_analysis_postgres.py`)

#### рдХрдиреЗрдХреНрд╢рди рдкреВрд▓ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди
```python
class PostgreSQLSchemaProvider:
    async def create_pool(self) -> None:
        """Create connection pool for better resource management."""
        if self.connection_pool is None:
            config_copy = dict(self.postgres_config)
            existing_server_settings = config_copy.pop("server_settings", {})
            
            merged_server_settings = {
                **existing_server_settings,
                "jit": "off",  # Disable JIT to reduce memory usage
                "work_mem": "4MB",  # Limit work memory per query
                "statement_timeout": "30s",  # 30 second statement timeout
            }
            
            self.connection_pool = await asyncpg.create_pool(
                **config_copy,
                min_size=1,
                max_size=3,  # Conservative pool size
                command_timeout=30,
                server_settings=merged_server_settings,
            )
```

**рдбрд┐рдЬрд╛рдЗрди рдврд╛рдБрдЪрд╛рд╣рд░реВ:**
- **рд╕реНрд░реЛрдд рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди**: рдЙрдЪрд┐рдд рдкреВрд▓ рдЬреАрд╡рдирдЪрдХреНрд░ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди
- **рдкреНрд░рджрд░реНрд╢рди рдЯреНрдпреБрдирд┐рдЩ**: рдЕрдиреБрдХреВрд▓рд┐рдд PostgreSQL рд╕реЗрдЯрд┐рдЩрд╣рд░реВ
- **рддреНрд░реБрдЯрд┐ рдкреБрдирдГрдкреНрд░рд╛рдкреНрддрд┐**: рдХрдиреЗрдХреНрд╢рди рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕ рд░ рдлрд▓рдмреНрдпрд╛рдХ рддрд░реНрдХ
- **рд╕реБрд░рдХреНрд╖рд╛**: рдкреНрд░рддреНрдпреЗрдХ рдХрдиреЗрдХреНрд╢рдирдорд╛ RLS рд╕рдиреНрджрд░реНрдн рд╕реЗрдЯрд┐рдЩ

#### рд╕реНрдХреАрдорд╛ рдЕрдиреНрд╡реЗрд╖рдг
```python
async def get_table_schema(self, table_name: str, rls_user_id: str) -> Dict[str, Any]:
    """Return comprehensive schema information for a table."""
    conn = await self.get_connection()
    
    # Set RLS context
    await conn.execute(
        "SELECT set_config('app.current_rls_user_id', $1, false)", 
        rls_user_id
    )
    
    # Get column information
    columns = await conn.fetch("""
        SELECT column_name, data_type, is_nullable, column_default
        FROM information_schema.columns 
        WHERE table_schema = $1 AND table_name = $2
        ORDER BY ordinal_position
    """, schema_name, table_name)
    
    # Get foreign key relationships
    foreign_keys = await conn.fetch("""
        SELECT kcu.column_name, ccu.table_name AS foreign_table_name
        FROM information_schema.table_constraints tc
        JOIN information_schema.key_column_usage kcu ON ...
    """)
```

### рд╕реЗрдореНрдпрд╛рдиреНрдЯрд┐рдХ рдЦреЛрдЬ рдПрдХреАрдХрд░рдг

#### рдЗрдореНрдмреЗрдбрд┐рдЩ рдЙрддреНрдкрд╛рджрди
```python
class SemanticSearchTextEmbedding:
    def generate_query_embedding(self, query: str) -> Optional[List[float]]:
        """Generate embeddings using Azure OpenAI."""
        try:
            response = self.client.embeddings.create(
                input=[query],
                model=self.deployment_name
            )
            return response.data[0].embedding
        except Exception as e:
            logger.error("Embedding generation failed: %s", e)
            return None
```

#### рднреЗрдХреНрдЯрд░ рд╕рдорд╛рдирддрд╛ рдЦреЛрдЬ
```python
async def search_products_by_similarity(
    self,
    query_embedding: List[float],
    rls_user_id: str,
    max_rows: int = 20,
    similarity_threshold: float = 30.0,
) -> str:
    """Search products using pgvector cosine similarity."""
    
    # Convert similarity percentage to distance threshold
    distance_threshold = 1.0 - (similarity_threshold / 100.0)
    
    query = f"""
        SELECT p.*, (pde.description_embedding <=> $1::vector) as distance
        FROM {SCHEMA_NAME}.product_description_embeddings pde
        JOIN {SCHEMA_NAME}.products p ON pde.product_id = p.product_id
        WHERE (pde.description_embedding <=> $1::vector) <= $3
        ORDER BY distance
        LIMIT $2
    """
    
    rows = await conn.fetch(query, embedding_str, max_rows, distance_threshold)
```

---

## рдкрд░рд┐рдирд┐рдпреЛрдЬрди рдорд╛рд░реНрдЧрджрд░реНрд╢рди

### Azure рдкреВрд░реНрд╡рд╛рдзрд╛рд░ рдкрд░рд┐рдирд┐рдпреЛрдЬрди

#### рез. **Bicep рдЯреЗрдореНрдкреНрд▓реЗрдЯ рд╕рдВрд░рдЪрдирд╛**

**рдореБрдЦреНрдп рдЯреЗрдореНрдкреНрд▓реЗрдЯ (`main.bicep`):**
```bicep
targetScope = 'subscription'

// Core parameters
param resourcePrefix string
param location string
param models array = [
  {
    name: 'text-embedding-3-small'
    format: 'OpenAI'
    version: '1'
    capacity: 50
  }
]

// Deploy foundry and project resources
module foundry 'foundry.bicep' = {
  name: 'foundry-account-deployment'
  scope: rg
  params: {
    foundryResourceName: foundryResourceName
    location: location
  }
}

module foundryProject 'foundry-project.bicep' = {
  name: 'foundry-project-deployment'
  scope: rg
  dependsOn: [foundry]
  params: {
    foundryResourceName: foundry.outputs.accountName
    aiProjectName: aiProjectName
  }
}
```

#### реи. **рдкрд░рд┐рдирд┐рдпреЛрдЬрди рд╕реНрд╡рдЪрд╛рд▓рди**

**PowerShell рдкрд░рд┐рдирд┐рдпреЛрдЬрди (`deploy.ps1`):**
```powershell
# Generate unique suffix for resources
$UNIQUE_SUFFIX = -join ((97..122) + (48..57) | Get-Random -Count 4 | ForEach-Object { [char]$_ })

# Deploy Azure resources
az deployment sub create `
  --name "$DEPLOYMENT_NAME" `
  --location "$RG_LOCATION" `
  --template-file main.bicep `
  --parameters location="$RG_LOCATION" `
  --parameters resourcePrefix="$RESOURCE_PREFIX" `
  --parameters uniqueSuffix="$UNIQUE_SUFFIX" `
  --parameters models="$modelsJson"

# Create service principal for authentication
$spResult = az ad sp create-for-rbac `
    --name "zava-mcp-server-sp" `
    --role "Cognitive Services OpenAI User" `
    --scopes "/subscriptions/$SubId/resourceGroups/$RESOURCE_GROUP_NAME"

# Generate .env file with configuration
@"
PROJECT_ENDPOINT=$PROJECTS_ENDPOINT
AZURE_OPENAI_ENDPOINT=$AZURE_OPENAI_ENDPOINT
EMBEDDING_MODEL_DEPLOYMENT_NAME="text-embedding-3-small"
AZURE_CLIENT_ID=$clientId
AZURE_CLIENT_SECRET=$clientSecret
AZURE_TENANT_ID=$tenantId
"@ | Out-File -FilePath "../.env"
```

### рд╕реНрдерд╛рдиреАрдп рд╡рд┐рдХрд╛рд╕ рд╕реЗрдЯрдЕрдк

#### рез. **Docker Compose рдХрдиреНрдлрд┐рдЧрд░реЗрд╕рди**
```yaml
# docker-compose.yml
version: '3.8'
services:
  postgres:
    image: pgvector/pgvector:pg17
    environment:
      - POSTGRES_INITDB_ARGS=--auth-host=scram-sha-256
    volumes:
      - ./data:/backup_data:ro
      - ./docker-init:/docker-entrypoint-initdb.d:ro
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres -d zava"]
      interval: 15s
      retries: 5

  mcp_server:
    build: .
    depends_on:
      postgres:
        condition: service_healthy
    ports:
      - "8000:8000"
    env_file:
      - .env
```

#### реи. **рдбреЗрдЯрд╛рдмреЗрд╕ рдЖрд░рдореНрдн**
```bash
# docker-init/init-db.sh
#!/bin/bash
set -e

# Create extensions
psql -v ON_ERROR_STOP=1 --username "$POSTGRES_USER" --dbname "$POSTGRES_DB" <<-EOSQL
    CREATE EXTENSION IF NOT EXISTS vector;
    CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
EOSQL

# Restore database backup
if [ -f /backup_data/zava_retail_2025_07_21_postgres_rls.backup ]; then
    pg_restore --username "$POSTGRES_USER" --dbname "$POSTGRES_DB" \
               --verbose --clean --no-acl --no-owner \
               /backup_data/zava_retail_2025_07_21_postgres_rls.backup
fi
```

---

## рд╕рдорд╛рдзрд╛рди рдкреНрд░рдпреЛрдЧ

### VS Code рдПрдХреАрдХрд░рдг

#### рез. **MCP рдХрдиреНрдлрд┐рдЧрд░реЗрд╕рди (`.vscode/mcp.json`)**
```json
{
    "servers": {
        "zava-sales-analysis-headoffice": {
            "url": "http://127.0.0.1:8000/mcp",
            "type": "http",
            "headers": {"x-rls-user-id": "00000000-0000-0000-0000-000000000000"}
        },
        "zava-sales-analysis-seattle": {
            "url": "http://127.0.0.1:8000/mcp",
            "type": "http", 
            "headers": {"x-rls-user-id": "f47ac10b-58cc-4372-a567-0e02b2c3d479"}
        }
    }
}
```

#### реи. **рдХреНрд╡реЗрд░реА рдЙрджрд╛рд╣рд░рдгрд╣рд░реВ**

**рд╕реНрдХреАрдорд╛ рдЕрдиреНрд╡реЗрд╖рдг:**
```
AI: #zava What tables are available in the database?
```
*MCP рд╕рд░реНрднрд░рд▓реЗ `get_multiple_table_schemas` рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ рддрд╛рд▓рд┐рдХрд╛ рд╕рдВрд░рдЪрдирд╛рд╣рд░реВ рдлрд┐рд░реНрддрд╛ рдЧрд░реНрджрдЫ*

**рдмрд┐рдХреНрд░реА рд╡рд┐рд╢реНрд▓реЗрд╖рдг:**
```
AI: #zava Show me the top 10 products by revenue last quarter
```
*рдЙрдкрдпреБрдХреНрдд рдЬреЛрдЗрди рд░ рдорд┐рддрд┐ рдлрд┐рд▓реНрдЯрд░рд┐рдЩрд╕рд╣рд┐рдд SQL рд╕рд┐рд░реНрдЬрдирд╛ рдЧрд░реНрджрдЫ*

**рд╕реЗрдореНрдпрд╛рдиреНрдЯрд┐рдХ рдЦреЛрдЬ:**
```
AI: #zava Find products similar to "waterproof electrical connectors"
```
*рдЗрдореНрдмреЗрдбрд┐рдЩреНрд╕ рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ рд╕реЗрдореНрдпрд╛рдиреНрдЯрд┐рдХ рд░реВрдкрдорд╛ рд╕рдорд╛рди рдЙрддреНрдкрд╛рджрдирд╣рд░реВ рдлреЗрд▓рд╛ рдкрд╛рд░реНрдЫ*

**рдмрд╣реБ-рд╕реНрдЯреЛрд░ рд╡рд┐рд╢реНрд▓реЗрд╖рдг:**
```
# Switch to Seattle store manager context
AI: #zava-seattle What are our best-selling categories this month?
```
*RLSрд▓реЗ рдорд╛рддреНрд░ рд╕рд┐рдПрдЯрд▓ рд╕реНрдЯреЛрд░ рдбрд╛рдЯрд╛рдорд╛ рдкрд╣реБрдБрдЪ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдЧрд░реНрджрдЫ*

### рдЙрдиреНрдирдд рдХреНрд╡реЗрд░реА рдврд╛рдБрдЪрд╛рд╣рд░реВ

#### рез. **рд╕рдордп-рд╢реНрд░реГрдВрдЦрд▓рд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг**
```sql
-- Generated by AI through MCP server
SELECT 
    DATE_TRUNC('month', o.order_date) as month,
    SUM(oi.total_amount) as revenue,
    COUNT(DISTINCT o.order_id) as order_count
FROM retail.orders o
JOIN retail.order_items oi ON o.order_id = oi.order_id
WHERE o.order_date >= CURRENT_DATE - INTERVAL '12 months'
GROUP BY DATE_TRUNC('month', o.order_date)
ORDER BY month;
```

#### реи. **рд╢реНрд░реЗрдгреАрд╣рд░реВрд╕рд╣рд┐рдд рдЙрддреНрдкрд╛рджрди рдкреНрд░рджрд░реНрд╢рди**
```sql
-- AI generates complex joins using schema information
SELECT 
    c.category_name,
    pt.type_name,
    COUNT(DISTINCT p.product_id) as product_count,
    SUM(oi.total_amount) as total_revenue,
    AVG(oi.unit_price) as avg_price
FROM retail.products p
JOIN retail.categories c ON p.category_id = c.category_id
JOIN retail.product_types pt ON p.product_type_id = pt.product_type_id
JOIN retail.order_items oi ON p.product_id = oi.product_id
GROUP BY c.category_name, pt.type_name
ORDER BY total_revenue DESC;
```

---

## рдЙрдиреНрдирдд рд╕реБрд╡рд┐рдзрд╛рд╣рд░реВ

### рд░реЛ рд▓реЗрднрд▓ рд╕реБрд░рдХреНрд╖рд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди

#### рез. **рдиреАрддрд┐ рд╕рд┐рд░реНрдЬрдирд╛**
```sql
-- Store-based access control
CREATE POLICY customer_store_policy ON retail.customers
  FOR ALL TO PUBLIC
  USING (store_id = get_current_store_id());

CREATE POLICY order_store_policy ON retail.orders  
  FOR ALL TO PUBLIC
  USING (store_id = get_current_store_id());

-- Function to get current user's store
CREATE OR REPLACE FUNCTION get_current_store_id()
RETURNS uuid AS $$
BEGIN
  RETURN current_setting('app.current_rls_user_id')::uuid;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

#### реи. **MCP рд╕рд░реНрднрд░рдорд╛ рд╕рдиреНрджрд░реНрдн рд╕реЗрдЯрд┐рдЩ**
```python
async def execute_query(self, sql_query: str, rls_user_id: str) -> str:
    """Execute query with RLS context."""
    conn = await self.get_connection()
    
    # Set RLS context for this connection
    await conn.execute(
        "SELECT set_config('app.current_rls_user_id', $1, false)", 
        rls_user_id
    )
    
    # Execute user query with RLS filtering
    rows = await conn.fetch(sql_query)
    return self.format_results(rows)
```

### рд╕реЗрдореНрдпрд╛рдиреНрдЯрд┐рдХ рдЦреЛрдЬ рдЧрд╣рд┐рд░реЛ рдЕрдзреНрдпрдпрди

#### рез. **рдЗрдореНрдмреЗрдбрд┐рдЩ рдкрд╛рдЗрдкрд▓рд╛рдЗрди**
```python
# Generate embeddings for product descriptions
async def generate_product_embeddings():
    products = await get_all_products()
    
    for product in products:
        description = f"{product.name} {product.description} {product.category}"
        embedding = embedding_client.generate_embedding(description)
        
        await store_embedding(product.id, embedding)
```

#### реи. **рд╕рдорд╛рдирддрд╛ рдЦреЛрдЬ рдЕрдиреБрдХреВрд▓рди**
```sql
-- Create vector index for performance
CREATE INDEX idx_product_embeddings_vector 
ON retail.product_description_embeddings 
USING ivfflat (description_embedding vector_cosine_ops);

-- Optimized similarity query
SELECT p.*, 
       (pde.description_embedding <=> $1::vector) as distance,
       (1 - (pde.description_embedding <=> $1::vector)) * 100 as similarity_percent
FROM retail.product_description_embeddings pde
JOIN retail.products p ON pde.product_id = p.product_id
WHERE (pde.description_embedding <=> $1::vector) < 0.7  -- 30% similarity threshold
ORDER BY distance
LIMIT 20;
```

### рдирд┐рдЧрд░рд╛рдиреА рд░ рдЕрд╡рд▓реЛрдХрдирд╢реАрд▓рддрд╛

#### рез. **Azure рдПрдкреНрд▓рд┐рдХреЗрд╕рди рдЗрдирд╕рд╛рдЗрдЯреНрд╕ рдПрдХреАрдХрд░рдг**
```python
# Configure telemetry
from azure.monitor.opentelemetry import configure_azure_monitor
from opentelemetry.instrumentation.starlette import StarletteInstrumentor

# Enable monitoring if configured
if config.applicationinsights_connection_string:
    configure_azure_monitor(
        connection_string=config.applicationinsights_connection_string
    )
    StarletteInstrumentor().instrument_app(mcp.sse_app())
```

#### реи. **рдЕрдиреБрдХреВрд▓рд┐рдд рдореЗрдЯреНрд░рд┐рдХреНрд╕ рд░ рд▓рдЧрд┐рдЩ**
```python
# Query execution tracking
@contextmanager
async def track_query_execution(query_type: str):
    start_time = time.time()
    try:
        yield
        duration = time.time() - start_time
        logger.info("Query executed", extra={
            "query_type": query_type,
            "duration_ms": duration * 1000,
            "status": "success"
        })
    except Exception as e:
        duration = time.time() - start_time
        logger.error("Query failed", extra={
            "query_type": query_type,
            "duration_ms": duration * 1000,
            "status": "error",
            "error": str(e)
        })
        raise
```

---

## рд╕рдорд╕реНрдпрд╛ рд╕рдорд╛рдзрд╛рди

### рд╕рд╛рдорд╛рдиреНрдп рд╕рдорд╕реНрдпрд╛рд╣рд░реВ рд░ рд╕рдорд╛рдзрд╛рдирд╣рд░реВ

#### рез. **рдбреЗрдЯрд╛рдмреЗрд╕ рдХрдиреЗрдХреНрд╢рди рд╕рдорд╕реНрдпрд╛рд╣рд░реВ**
```python
# Connection diagnostics
async def diagnose_connection():
    try:
        pool = await asyncpg.create_pool(**connection_params, min_size=1)
        conn = await pool.acquire()
        result = await conn.fetchval("SELECT 1")
        await pool.release(conn)
        await pool.close()
        return True
    except Exception as e:
        logger.error("Connection failed: %s", e)
        return False
```

**рд╕рд╛рдорд╛рдиреНрдп рд╕рдорд╛рдзрд╛рдирд╣рд░реВ:**
- PostgreSQL рдЪрд▓рд┐рд░рд╣реЗрдХреЛ рдЫ рднрдиреА рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдЧрд░реНрдиреБрд╣реЛрд╕реН: `docker ps`
- `.env` рдорд╛ рдХрдиреЗрдХреНрд╢рди рдкреНрдпрд╛рд░рд╛рдорд┐рдЯрд░рд╣рд░реВ рдЬрд╛рдБрдЪ рдЧрд░реНрдиреБрд╣реЛрд╕реН
- рдбреЗрдЯрд╛рдмреЗрд╕ рдЕрд╡рд╕реНрдерд┐рдд рдЫ рднрдиреА рдкреНрд░рдорд╛рдгрд┐рдд рдЧрд░реНрдиреБрд╣реЛрд╕реН: `docker exec -it pg17 psql -U postgres -l`
- рдиреЗрдЯрд╡рд░реНрдХ рдХрдиреЗрдХреНрдЯрд┐рднрд┐рдЯреА рдкрд░реАрдХреНрд╖рдг рдЧрд░реНрдиреБрд╣реЛрд╕реН: `telnet localhost 5432`

#### реи. **RLS рдиреАрддрд┐ рд╕рдорд╕реНрдпрд╛рд╣рд░реВ**
```sql
-- Debug RLS policies
SELECT schemaname, tablename, policyname, cmd, qual 
FROM pg_policies 
WHERE schemaname = 'retail';

-- Check current RLS setting
SELECT current_setting('app.current_rls_user_id');

-- Temporarily disable RLS for debugging
ALTER TABLE retail.orders DISABLE ROW LEVEL SECURITY;
```

#### рей. **рдЗрдореНрдмреЗрдбрд┐рдЩ рд╕реЗрд╡рд╛ рд╕рдорд╕реНрдпрд╛рд╣рд░реВ**
```python
# Test embedding generation
async def test_embeddings():
    try:
        test_text = "waterproof electrical connector"
        embedding = embedding_client.generate_embedding(test_text)
        logger.info("Embedding generated successfully: %d dimensions", len(embedding))
        return True
    except Exception as e:
        logger.error("Embedding test failed: %s", e)
        return False
```

### рдкреНрд░рджрд░реНрд╢рди рдЕрдиреБрдХреВрд▓рди

#### рез. **рдХрдиреЗрдХреНрд╢рди рдкреВрд▓ рдЯреНрдпреБрдирд┐рдЩ**
```python
# Optimize for your workload
connection_pool = await asyncpg.create_pool(
    min_size=2,          # Minimum connections
    max_size=10,         # Maximum connections  
    max_inactive_connection_lifetime=300,  # 5 minutes
    command_timeout=30,   # Query timeout
    server_settings={
        "application_name": "mcp-server",
        "work_mem": "4MB",
        "shared_preload_libraries": "pg_stat_statements"
    }
)
```

#### реи. **рдХреНрд╡реЗрд░реА рдЕрдиреБрдХреВрд▓рди**
```sql
-- Add indexes for common query patterns
CREATE INDEX idx_orders_store_date 
ON retail.orders (store_id, order_date);

CREATE INDEX idx_order_items_product 
ON retail.order_items (product_id);

-- Analyze query performance
EXPLAIN (ANALYZE, BUFFERS) 
SELECT ... FROM retail.orders o JOIN retail.order_items oi ...;
```

---

## рд╕рд░реНрд╡реЛрддреНрддрдо рдЕрднреНрдпрд╛рд╕рд╣рд░реВ

### рд╕реБрд░рдХреНрд╖рд╛ рд╕рд░реНрд╡реЛрддреНрддрдо рдЕрднреНрдпрд╛рд╕рд╣рд░реВ

#### рез. **рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди**
```bash
# Use strong, unique passwords
POSTGRES_PASSWORD=$(openssl rand -base64 32)

# Rotate service principal credentials regularly
az ad sp credential reset --id $SP_ID --credential-description "Rotated $(date)"

# Use Azure Key Vault in production
az keyvault secret set --vault-name $VAULT_NAME --name "db-password" --value $PASSWORD
```

#### реи. **RLS рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рджрд┐рд╢рд╛рдирд┐рд░реНрджреЗрд╢рд╣рд░реВ**
- **рдбрд┐рдлрд▓реНрдЯ рдЕрд╕реНрд╡реАрдХреГрддрд┐**: рдкреНрд░рддрд┐рдмрдиреНрдзрд╛рддреНрдордХ рдиреАрддрд┐рд╣рд░реВрд╕рдБрдЧ рд╕реБрд░реБ рдЧрд░реНрдиреБрд╣реЛрд╕реН
- **рдирд┐рдпрдорд┐рдд рдЕрдбрд┐рдЯ**: рдиреАрддрд┐ рдкреНрд░рднрд╛рд╡рдХрд╛рд░рд┐рддрд╛ рдирд┐рдЧрд░рд╛рдиреА рдЧрд░реНрдиреБрд╣реЛрд╕реН
- **рдереЛрд░реИ рдкрд░реАрдХреНрд╖рдг рдЧрд░реНрдиреБрд╣реЛрд╕реН**: рдкрд╣реБрдБрдЪ рдврд╛рдБрдЪрд╛рд╣рд░реВ рдорд╛рдиреНрдп рдЧрд░реНрдиреБрд╣реЛрд╕реН
- **рдиреАрддрд┐рд╣рд░реВ рджрд╕реНрддрд╛рд╡реЗрдЬ рдЧрд░реНрдиреБрд╣реЛрд╕реН**: рд╕реНрдкрд╖реНрдЯ рджрд╕реНрддрд╛рд╡реЗрдЬреАрдХрд░рдг рдХрд╛рдпрдо рдЧрд░реНрдиреБрд╣реЛрд╕реН

#### рей. **рдиреЗрдЯрд╡рд░реНрдХ рд╕реБрд░рдХреНрд╖рд╛**
```yaml
# Production docker-compose with network isolation
networks:
  internal:
    driver: bridge
    internal: true
  external:
    driver: bridge

services:
  postgres:
    networks:
      - internal
    # No external ports in production
  
  mcp_server:
    networks:
      - internal
      - external
    ports:
      - "127.0.0.1:8000:8000"  # Bind to localhost only
```

### рд╡рд┐рдХрд╛рд╕ рд╕рд░реНрд╡реЛрддреНрддрдо рдЕрднреНрдпрд╛рд╕рд╣рд░реВ

#### рез. **рддреНрд░реБрдЯрд┐ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди рдврд╛рдБрдЪрд╛рд╣рд░реВ**
```python
# Structured error responses
class MCPError(Exception):
    def __init__(self, message: str, error_type: str = "general"):
        self.message = message
        self.error_type = error_type
        super().__init__(message)

async def safe_execute_query(query: str, rls_user_id: str) -> str:
    try:
        return await db_provider.execute_query(query, rls_user_id)
    except asyncpg.PostgresError as e:
        logger.error("Database error: %s", e)
        return json.dumps({"error": "Database query failed", "type": "database"})
    except Exception as e:
        logger.error("Unexpected error: %s", e)
        return json.dumps({"error": "Internal server error", "type": "server"})
```

#### реи. **рдкрд░реАрдХреНрд╖рдг рд░рдгрдиреАрддрд┐рд╣рд░реВ**
```python
# Unit test example
@pytest.mark.asyncio
async def test_rls_isolation():
    """Test that RLS properly isolates store data."""
    
    # Test Seattle store manager
    seattle_results = await db_provider.execute_query(
        "SELECT COUNT(*) FROM retail.orders",
        rls_user_id="f47ac10b-58cc-4372-a567-0e02b2c3d479"
    )
    
    # Test Redmond store manager  
    redmond_results = await db_provider.execute_query(
        "SELECT COUNT(*) FROM retail.orders", 
        rls_user_id="e7f8a9b0-c1d2-3e4f-5678-90abcdef1234"
    )
    
    # Results should be different due to RLS
    assert seattle_results != redmond_results
```

#### рей. **рдирд┐рдЧрд░рд╛рдиреА рд░ рдЕрд▓рд░реНрдЯрд╣рд░реВ**
```python
# Custom metrics for monitoring
from prometheus_client import Counter, Histogram, start_http_server

query_counter = Counter('mcp_queries_total', 'Total queries executed', ['query_type'])
query_duration = Histogram('mcp_query_duration_seconds', 'Query execution time')

@query_duration.time()
async def execute_query_with_metrics(query: str, rls_user_id: str):
    query_counter.labels(query_type='sales_analysis').inc()
    return await db_provider.execute_query(query, rls_user_id)
```

### рдкрд░рд┐рдирд┐рдпреЛрдЬрди рд╕рд░реНрд╡реЛрддреНрддрдо рдЕрднреНрдпрд╛рд╕рд╣рд░реВ

#### рез. **рдХреЛрдбрдХреЛ рдкреВрд░реНрд╡рд╛рдзрд╛рд░**
```bicep
// Use parameter files for different environments
param environment string = 'dev'
param location string = 'westus2'

// Apply consistent naming conventions
var resourcePrefix = 'zava-mcp-${environment}'
var resourceGroupName = 'rg-${resourcePrefix}-${uniqueSuffix}'

// Use tags for resource management
var commonTags = {
  Environment: environment
  Project: 'zava-mcp-server'
  ManagedBy: 'bicep'
  CreatedDate: utcNow('yyyy-MM-dd')
}
```

#### реи. **CI/CD рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдПрдХреАрдХрд░рдг**
```yaml
# Azure DevOps pipeline example
- task: AzureCLI@2
  displayName: 'Deploy Infrastructure'
  inputs:
    azureSubscription: $(azureServiceConnection)
    scriptType: 'bash'
    scriptLocation: 'inlineScript'
    inlineScript: |
      az deployment sub create \
        --name "mcp-server-$(Build.BuildId)" \
        --location $(location) \
        --template-file infra/main.bicep \
        --parameters environment=$(environment)

- task: Docker@2
  displayName: 'Build and Push MCP Server'
  inputs:
    command: 'buildAndPush'
    repository: 'zava-mcp-server'
    tags: '$(Build.BuildId)'
```

---

рдпреЛ рд╡реНрдпрд╛рдкрдХ рдорд╛рд░реНрдЧрджрд░реНрд╢рдирд▓реЗ рдЙрддреНрдкрд╛рджрди-рддрдпрд╛рд░ MCP рд╕рд░реНрднрд░ рдирд┐рд░реНрдорд╛рдг, рдкрд░рд┐рдирд┐рдпреЛрдЬрди, рд░ рд╕рдЮреНрдЪрд╛рд▓рдирдХреЛ рдЖрдзрд╛рд░ рдкреНрд░рджрд╛рди рдЧрд░реНрджрдЫ, рдЬрд╕рд▓реЗ PostgreSQL рдПрдХреАрдХрд░рдгрд▓рд╛рдИ рд╕рдорд╛рд╡реЗрд╢ рдЧрд░реНрджрдЫред рдпрд╣рд╛рдБ рдкреНрд░рджрд░реНрд╢рди рдЧрд░рд┐рдПрдХрд╛ рдврд╛рдБрдЪрд╛рд╣рд░реВ рд░ рдЕрднреНрдпрд╛рд╕рд╣рд░реВ рдЕрдиреНрдп рдбреЛрдореЗрди рд░ рдкреНрд░рдпреЛрдЧ рдХреЗрд╕рд╣рд░реВрдорд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдЧрд░реНрди рд╕рдХрд┐рдиреНрдЫ, рд╕реБрд░рдХреНрд╖рд╛, рдкреНрд░рджрд░реНрд╢рди, рд░ рдорд░реНрдорддрдпреЛрдЧреНрдпрддрд╛ рдХрд╛рдпрдо рд░рд╛рдЦреНрджреИред

---

**рдЕрд╕реНрд╡реАрдХрд░рдг**:  
рдпреЛ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ AI рдЕрдиреБрд╡рд╛рдж рд╕реЗрд╡рд╛ [Co-op Translator](https://github.com/Azure/co-op-translator) рдкреНрд░рдпреЛрдЧ рдЧрд░реЗрд░ рдЕрдиреБрд╡рд╛рдж рдЧрд░рд┐рдПрдХреЛ рд╣реЛред рд╣рд╛рдореА рдпрдерд╛рд╕рдореНрднрд╡ рд╢реБрджреНрдзрддрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдЧрд░реНрди рдкреНрд░рдпрд╛рд╕ рдЧрд░реНрдЫреМрдВ, рддрд░ рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджрд┐рдиреБрд╣реЛрд╕реН рдХрд┐ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЕрдиреБрд╡рд╛рджрдорд╛ рддреНрд░реБрдЯрд┐рд╣рд░реВ рд╡рд╛ рдЕрд╢реБрджреНрдзрддрд╛рд╣рд░реВ рд╣реБрди рд╕рдХреНрдЫред рдореВрд▓ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдпрд╕рдХреЛ рдорд╛рддреГрднрд╛рд╖рд╛рдорд╛ рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рд╕реНрд░реЛрдд рдорд╛рдирд┐рдиреБрдкрд░реНрдЫред рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЬрд╛рдирдХрд╛рд░реАрдХреЛ рд▓рд╛рдЧрд┐, рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рдорд╛рдирд╡ рдЕрдиреБрд╡рд╛рдж рд╕рд┐рдлрд╛рд░рд┐рд╕ рдЧрд░рд┐рдиреНрдЫред рдпрд╕ рдЕрдиреБрд╡рд╛рджрдХреЛ рдкреНрд░рдпреЛрдЧрдмрд╛рдЯ рдЙрддреНрдкрдиреНрди рд╣реБрдиреЗ рдХреБрдиреИ рдкрдирд┐ рдЧрд▓рддрдлрд╣рдореА рд╡рд╛ рдЧрд▓рдд рд╡реНрдпрд╛рдЦреНрдпрд╛рдХреЛ рд▓рд╛рдЧрд┐ рд╣рд╛рдореА рдЬрд┐рдореНрдореЗрд╡рд╛рд░ рд╣реБрдиреЗ рдЫреИрдиреМрдВред